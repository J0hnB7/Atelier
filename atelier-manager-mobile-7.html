<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Atelier">
    <title>Atelier Manager - Spr√°va zak√°zkov√©ho ≈°it√≠</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Inter:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #faf8f5 0%, #f5f1eb 100%);
            min-height: 100vh;
            color: #292524;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        .heading-font {
            font-family: 'Cormorant Garamond', serif;
        }
        
        /* Layout */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Header - Mobile optimized */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e7e5e4;
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 1rem 0;
        }
        
        .header h1 {
            font-size: 1.5rem;
            color: #292524;
            font-weight: 600;
            letter-spacing: 0.02em;
        }
        
        .header p {
            color: #78716c;
            margin-top: 0.25rem;
            font-size: 0.875rem;
        }
        
        /* Navigation - Mobile optimized */
        .nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e7e5e4;
            position: sticky;
            top: 64px;
            z-index: 40;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .nav::-webkit-scrollbar {
            display: none;
        }
        
        .nav-list {
            display: flex;
            gap: 0;
            list-style: none;
            min-width: min-content;
        }
        
        .nav-button {
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            padding: 0.875rem 1rem;
            cursor: pointer;
            font-size: 0.8125rem;
            font-weight: 500;
            color: #78716c;
            white-space: nowrap;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .nav-button:active {
            transform: scale(0.95);
        }
        
        .nav-button.active {
            color: #292524;
            border-bottom-color: #8b7460;
        }
        
        /* Main Content */
        .main {
            padding: 1rem 0 5rem 0;
            min-height: calc(100vh - 140px);
        }
        
        /* Cards - Mobile optimized */
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(139, 116, 96, 0.1);
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        
        .card:active {
            transform: scale(0.98);
        }
        
        /* Grid - Responsive */
        .grid {
            display: grid;
            gap: 1rem;
        }
        
        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(2, 1fr); }
        
        @media (min-width: 768px) {
            .header h1 { font-size: 2rem; }
            .header { padding: 1.5rem 0; }
            .nav { top: 88px; }
            .grid-3 { grid-template-columns: repeat(3, 1fr); }
            .grid-4 { grid-template-columns: repeat(4, 1fr); }
            .card { padding: 1.5rem; }
        }
        
        /* Buttons - Touch optimized */
        .btn {
            padding: 0.875rem 1.25rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            touch-action: manipulation;
            min-height: 44px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8b7460 0%, #a89380 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(139, 116, 96, 0.3);
        }
        
        .btn-secondary {
            background: #f5f5f4;
            color: #292524;
            border: 1px solid #d6d3d1;
        }
        
        .btn-danger {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .btn-success {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }
        
        .btn-small {
            padding: 0.5rem 0.75rem;
            font-size: 1.25rem;
            min-height: 44px;
            min-width: 44px;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #8b7460 0%, #a89380 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(139, 116, 96, 0.3);
            font-size: 1.5rem;
        }
        
        /* Forms - Touch optimized */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #292524;
            margin-bottom: 0.5rem;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #e8e3dc;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s;
            min-height: 44px;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #8b7460;
            box-shadow: 0 0 0 4px rgba(139, 116, 96, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Stats Cards - Mobile optimized */
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #faf8f5 100%);
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(139, 116, 96, 0.1);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #78716c;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #292524;
            margin-top: 0.5rem;
        }
        
        @media (min-width: 768px) {
            .stat-card { padding: 1.5rem; }
            .stat-icon { font-size: 2.5rem; }
            .stat-label { font-size: 0.875rem; }
            .stat-value { font-size: 1.5rem; }
        }
        
        /* List Items - Touch optimized */
        .list-item {
            background: #fafaf9;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            transition: background 0.2s;
            touch-action: manipulation;
        }
        
        .list-item:active {
            background: #f5f5f4;
        }
        
        /* Fabric Card - Mobile optimized */
        .fabric-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(139, 116, 96, 0.1);
            overflow: hidden;
        }
        
        .fabric-image {
            width: 100%;
            height: 10rem;
            background: #f5f5f4;
            overflow: hidden;
        }
        
        .fabric-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .fabric-content {
            padding: 1rem;
        }
        
        .fabric-name {
            font-size: 1rem;
            font-weight: 600;
            color: #292524;
            margin-bottom: 0.75rem;
        }
        
        .fabric-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.8125rem;
            color: #57534e;
        }
        
        .fabric-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        /* Order Card - Mobile optimized */
        .order-card {
            border: 2px solid #e7e5e4;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .order-card:active {
            border-color: #8b7460;
        }
        
        .order-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        
        .order-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e7e5e4;
        }
        
        /* Image Grid - Mobile optimized */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .image-preview {
            position: relative;
            width: 100%;
            height: 5rem;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-remove {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.75rem;
            height: 1.75rem;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #a8a29e;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        /* Summary Section */
        .summary-section {
            background: #fafaf9;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .summary-total {
            display: flex;
            justify-content: space-between;
            padding-top: 0.75rem;
            border-top: 2px solid #d6d3d1;
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 0.75rem;
        }
        
        /* Modal/Overlay for export */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        /* Utility Classes */
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .space-y-8 > * + * { margin-top: 2rem; }
        
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-end { justify-content: flex-end; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        .text-gray { color: #78716c; }
        .text-green { color: #16a34a; }
        
        .border-t { border-top: 1px solid #e7e5e4; }
        .border-b { border-bottom: 1px solid #e7e5e4; }
        .pt-4 { padding-top: 1rem; }
        .pt-6 { padding-top: 1.5rem; }
        .pb-4 { padding-bottom: 1rem; }
        
        .flex-1 { flex: 1; }
        .w-full { width: 100%; }
        .hidden { display: none; }
        
        /* Animation */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Success message */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: #16a34a;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* iOS Safe Area */
        @supports (padding: env(safe-area-inset-bottom)) {
            .main {
                padding-bottom: calc(5rem + env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Utility functions
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('cs-CZ', { style: 'currency', currency: 'CZK' }).format(amount);
        };
        
        const formatDate = (date) => {
            return new Date(date).toLocaleDateString('cs-CZ');
        };

        // Toast notification component
        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="toast">
                    {message}
                </div>
            );
        };

        // LocalStorage hooks
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error(error);
                    return initialValue;
                }
            });

            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) {
                    console.error(error);
                }
            };

            return [storedValue, setValue];
        };

        // Helper functions
        const calculateOrderTotal = (order) => {
            // Return sale price if available, otherwise calculate from old margin system for backwards compatibility
            if (order.salePrice) {
                return order.salePrice;
            }
            // Fallback for old orders with margin
            const fabricsCost = order.fabrics?.reduce((sum, f) => sum + f.totalCost, 0) || 0;
            const decorationsCost = order.decorations?.reduce((sum, d) => sum + d.totalCost, 0) || 0;
            const prepCost = (order.preparationTime || 0) * (order.preparationRate || 0);
            const seamCost = (order.seamstressTime || 0) * (order.seamstressRate || 0);
            const extraCost = order.extras?.reduce((sum, e) => sum + e.price, 0) || 0;
            const subtotal = fabricsCost + decorationsCost + prepCost + seamCost + extraCost;
            const margin = order.margin || 0;
            return subtotal * (1 + margin / 100);
        };

        const calculateOrderCosts = (order) => {
            const fabricsCost = order.fabrics?.reduce((sum, f) => sum + f.totalCost, 0) || 0;
            const decorationsCost = order.decorations?.reduce((sum, d) => sum + d.totalCost, 0) || 0;
            const prepCost = (order.preparationTime || 0) * (order.preparationRate || 0);
            const seamCost = (order.seamstressTime || 0) * (order.seamstressRate || 0);
            const extrasCost = order.extras?.reduce((sum, e) => sum + e.price, 0) || 0;
            return fabricsCost + decorationsCost + prepCost + seamCost + extrasCost;
        };

        // Export/Import Modal Component
        const ExportImportModal = ({ onClose, fabrics, setFabrics, decorations, setDecorations, orders, setOrders, rates, setRates }) => {
            const exportData = () => {
                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    fabrics,
                    decorations,
                    orders,
                    rates
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `atelier-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.version && data.fabrics && data.orders && data.rates) {
                            if (window.confirm('Opravdu chcete importovat data? Souƒçasn√° data budou p≈ôeps√°na.')) {
                                setFabrics(data.fabrics);
                                setDecorations(data.decorations || []);
                                setOrders(data.orders);
                                setRates(data.rates);
                                alert('‚úÖ Data byla √∫spƒõ≈°nƒõ importov√°na!');
                                onClose();
                            }
                        } else {
                            alert('‚ùå Neplatn√Ω form√°t souboru!');
                        }
                    } catch (error) {
                        alert('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ souboru!');
                    }
                };
                reader.readAsText(file);
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <h3 className="modal-title">üíæ Export / Import dat</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <h4 className="font-semibold mb-2">Export dat</h4>
                                <p className="text-sm text-gray mb-3">
                                    St√°hnƒõte v≈°echna va≈°e data jako z√°lo≈æn√≠ soubor JSON
                                </p>
                                <button
                                    onClick={exportData}
                                    className="btn btn-primary w-full"
                                >
                                    üì• St√°hnout z√°lohu
                                </button>
                            </div>

                            <div className="border-t pt-4">
                                <h4 className="font-semibold mb-2">Import dat</h4>
                                <p className="text-sm text-gray mb-3">
                                    Nahrajte z√°lo≈æn√≠ soubor JSON
                                </p>
                                <input
                                    type="file"
                                    accept=".json"
                                    onChange={importData}
                                    className="form-input"
                                />
                            </div>
                        </div>

                        <div className="modal-actions">
                            <button
                                onClick={onClose}
                                className="btn btn-secondary flex-1"
                            >
                                Zav≈ô√≠t
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const AtelierManager = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [fabrics, setFabrics] = useLocalStorage('fabrics', []);
            const [decorations, setDecorations] = useLocalStorage('decorations', []);
            const [orders, setOrders] = useLocalStorage('orders', []);
            const [rates, setRates] = useLocalStorage('rates', {
                preparation: 500,
                seamstress: 400
            });
            const [logo, setLogo] = useLocalStorage('appLogo', '‚úÇÔ∏è');
            const [showExportModal, setShowExportModal] = useState(false);
            const [toast, setToast] = useState(null);

            const showToast = (message) => {
                setToast(message);
            };

            const tabs = [
                { id: 'dashboard', label: 'üìä P≈ôehled' },
                { id: 'inventory', label: 'üì¶ Sklad' },
                { id: 'orders', label: 'üõçÔ∏è Zak√°zky' },
                { id: 'history', label: 'üìú Historie' },
                { id: 'settings', label: '‚öôÔ∏è Nastaven√≠' }
            ];

            return (
                <div>
                    {/* Header */}
                    <header className="header">
                        <div className="container">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="heading-font" style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        {logo.startsWith('data:') ? (
                                            <img src={logo} alt="Logo" style={{height: '2rem', width: 'auto', objectFit: 'contain'}} />
                                        ) : (
                                            <span>{logo}</span>
                                        )}
                                        <span>Atelier</span>
                                    </h1>
                                    <p>Spr√°va ≈°it√≠</p>
                                </div>
                                <button
                                    onClick={() => setShowExportModal(true)}
                                    className="btn btn-primary btn-small btn-export"
                                    title="Export/Import dat"
                                >
                                    üíæ
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="nav">
                        <div className="container">
                            <ul className="nav-list">
                                {tabs.map(tab => (
                                    <li key={tab.id}>
                                        <button
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`nav-button ${activeTab === tab.id ? 'active' : ''}`}
                                        >
                                            {tab.label}
                                        </button>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="main">
                        <div className="container">
                            {activeTab === 'dashboard' && (
                                <Dashboard orders={orders} fabrics={fabrics} decorations={decorations} />
                            )}
                            {activeTab === 'inventory' && (
                                <Inventory fabrics={fabrics} setFabrics={setFabrics} decorations={decorations} setDecorations={setDecorations} orders={orders} showToast={showToast} />
                            )}
                            {activeTab === 'orders' && (
                                <Orders 
                                    orders={orders} 
                                    setOrders={setOrders} 
                                    fabrics={fabrics}
                                    decorations={decorations}
                                    rates={rates}
                                    showToast={showToast}
                                />
                            )}
                            {activeTab === 'history' && (
                                <History orders={orders} setOrders={setOrders} showToast={showToast} />
                            )}
                            {activeTab === 'settings' && (
                                <Settings 
                                    rates={rates} 
                                    setRates={setRates}
                                    fabrics={fabrics}
                                    decorations={decorations}
                                    orders={orders}
                                    logo={logo}
                                    setLogo={setLogo}
                                    showToast={showToast}
                                />
                            )}
                        </div>
                    </main>

                    {/* Export/Import Modal */}
                    {showExportModal && (
                        <ExportImportModal
                            onClose={() => setShowExportModal(false)}
                            fabrics={fabrics}
                            setFabrics={setFabrics}
                            decorations={decorations}
                            setDecorations={setDecorations}
                            orders={orders}
                            setOrders={setOrders}
                            rates={rates}
                            setRates={setRates}
                        />
                    )}

                    {/* Toast Notification */}
                    {toast && (
                        <Toast message={toast} onClose={() => setToast(null)} />
                    )}
                </div>
            );
        };

        // Dashboard Component
        const Dashboard = ({ orders, fabrics, decorations }) => {
            const activeOrders = orders.filter(o => o.status === 'active');
            const completedOrders = orders.filter(o => o.status === 'completed');
            
            const totalRevenue = completedOrders.reduce((sum, order) => {
                const total = calculateOrderTotal(order);
                return sum + total;
            }, 0);
            
            const totalCosts = completedOrders.reduce((sum, order) => {
                const costs = calculateOrderCosts(order);
                return sum + costs;
            }, 0);
            
            const totalProfit = totalRevenue - totalCosts;

            const stats = [
                { label: 'Aktivn√≠ zak√°zky', value: activeOrders.length, icon: 'üõçÔ∏è' },
                { label: 'Dokonƒçen√©', value: completedOrders.length, icon: '‚úÖ' },
                { label: 'Celkov√Ω obrat', value: formatCurrency(totalRevenue), icon: 'üìà' },
                { label: 'Celkov√Ω zisk', value: formatCurrency(totalProfit), icon: 'üí∞' }
            ];

            return (
                <div className="fade-in space-y-6">
                    {/* Stats Grid */}
                    <div className="grid grid-4">
                        {stats.map((stat, index) => (
                            <div key={index} className="stat-card">
                                <div className="stat-icon text-center">{stat.icon}</div>
                                <p className="stat-label text-center">{stat.label}</p>
                                <p className="stat-value text-center">{stat.value}</p>
                            </div>
                        ))}
                    </div>

                    {/* Recent Orders */}
                    <div className="card">
                        <h2 className="text-lg heading-font font-semibold mb-3">
                            Posledn√≠ zak√°zky
                        </h2>
                        {orders.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-icon">üì≠</div>
                                <p>Zat√≠m nem√°te ≈æ√°dn√© zak√°zky</p>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {orders.slice(0, 5).map(order => (
                                    <div key={order.id} className="list-item">
                                        <div className="flex items-center justify-between gap-3">
                                            <div className="flex items-center gap-2 flex-1 min-w-0">
                                                <div className="text-xl">
                                                    {order.status === 'active' ? '‚è≥' : '‚úÖ'}
                                                </div>
                                                <div className="min-w-0 flex-1">
                                                    <p className="font-medium text-sm truncate">{order.name}</p>
                                                    <p className="text-xs text-gray">{formatDate(order.createdAt)}</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-semibold text-sm">
                                                    {formatCurrency(calculateOrderTotal(order))}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Fabric Inventory Summary */}
                    <div className="card text-center">
                        <h2 className="text-lg heading-font font-semibold mb-3">
                            üì¶ P≈ôehled skladu
                        </h2>
                        <div className="grid grid-2 gap-3 mb-3">
                            <div>
                                <div className="text-2xl font-bold mb-1">
                                    {fabrics.length}
                                </div>
                                <p className="text-xs text-gray mb-2">Druh≈Ø l√°tek</p>
                                <div className="text-lg font-semibold text-gray">
                                    {formatCurrency(fabrics.reduce((sum, f) => sum + (f.pricePerM2 * f.quantity), 0))}
                                </div>
                                <p className="text-xs text-gray">Hodnota l√°tek</p>
                            </div>
                            <div>
                                <div className="text-2xl font-bold mb-1">
                                    {decorations?.length || 0}
                                </div>
                                <p className="text-xs text-gray mb-2">Druh≈Ø zdoben√≠</p>
                                <div className="text-lg font-semibold text-gray">
                                    {formatCurrency((decorations || []).reduce((sum, d) => sum + (d.price * d.quantity), 0))}
                                </div>
                                <p className="text-xs text-gray">Hodnota zdoben√≠</p>
                            </div>
                        </div>
                        <div className="border-t pt-2">
                            <div className="text-xl font-semibold text-gray mb-1">
                                {formatCurrency(
                                    fabrics.reduce((sum, f) => sum + (f.pricePerM2 * f.quantity), 0) +
                                    (decorations || []).reduce((sum, d) => sum + (d.price * d.quantity), 0)
                                )}
                            </div>
                            <p className="text-xs text-gray">Celkov√° hodnota skladu</p>
                        </div>
                    </div>
                </div>
            );
        };

        // Inventory Component
        const Inventory = ({ fabrics, setFabrics, decorations, setDecorations, orders, showToast }) => {
            const [inventoryTab, setInventoryTab] = useState('fabrics');
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                type: '',
                quantity: '',
                pricePerM2: '',
                color: '',
                image: '',
                unit: 'ks' // for decorations
            });

            // Helper function to check if item is used in active orders
            const isItemUsedInOrders = (itemId, type) => {
                return orders?.filter(o => o.status === 'active').some(order => {
                    if (type === 'fabric') {
                        return order.fabrics?.some(f => f.fabricId === itemId);
                    } else {
                        return order.decorations?.some(d => d.decorationId === itemId);
                    }
                });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (inventoryTab === 'fabrics') {
                    const fabricData = {
                        ...formData,
                        id: editingId || Date.now().toString(),
                        quantity: parseFloat(formData.quantity),
                        pricePerM2: parseFloat(formData.pricePerM2),
                        createdAt: editingId ? fabrics.find(f => f.id === editingId)?.createdAt : new Date().toISOString()
                    };

                    if (editingId) {
                        setFabrics(fabrics.map(f => f.id === editingId ? fabricData : f));
                        showToast('‚úÖ L√°tka aktualizov√°na');
                    } else {
                        setFabrics([...fabrics, fabricData]);
                        showToast('‚úÖ L√°tka p≈ôid√°na');
                    }
                } else {
                    // Decorations
                    const decorationData = {
                        id: editingId || Date.now().toString(),
                        name: formData.name,
                        color: formData.color,
                        price: parseFloat(formData.pricePerM2), // reusing this field for decoration price
                        quantity: parseFloat(formData.quantity),
                        unit: formData.unit || 'ks',
                        image: formData.image,
                        createdAt: editingId ? decorations.find(d => d.id === editingId)?.createdAt : new Date().toISOString()
                    };

                    if (editingId) {
                        setDecorations(decorations.map(d => d.id === editingId ? decorationData : d));
                        showToast('‚úÖ Zdoben√≠ aktualizov√°no');
                    } else {
                        setDecorations([...decorations, decorationData]);
                        showToast('‚úÖ Zdoben√≠ p≈ôid√°no');
                    }
                }

                resetForm();
            };

            const handleEdit = (item, type) => {
                if (type === 'fabric') {
                    setFormData(item);
                    setInventoryTab('fabrics');
                } else {
                    setFormData({
                        name: item.name,
                        color: item.color,
                        quantity: item.quantity.toString(),
                        pricePerM2: item.price.toString(),
                        unit: item.unit || 'ks',
                        image: item.image || '',
                        type: ''
                    });
                    setInventoryTab('decorations');
                }
                setEditingId(item.id);
                setShowForm(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleDelete = (id, type) => {
                if (window.confirm(`Opravdu chcete smazat tuto polo≈æku?`)) {
                    if (type === 'fabric') {
                        setFabrics(fabrics.filter(f => f.id !== id));
                        showToast('‚úÖ L√°tka smaz√°na');
                    } else {
                        setDecorations(decorations.filter(d => d.id !== id));
                        showToast('‚úÖ Zdoben√≠ smaz√°no');
                    }
                }
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    type: '',
                    quantity: '',
                    pricePerM2: '',
                    color: '',
                    image: '',
                    unit: 'ks'
                });
                setEditingId(null);
                setShowForm(false);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2000000) {
                        alert('‚ö†Ô∏è Obr√°zek je p≈ô√≠li≈° velk√Ω (max 2MB)');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setFormData({ ...formData, image: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="fade-in space-y-4">
                    <div className="flex items-center justify-between">
                        <h2 className="text-xl heading-font font-semibold">
                            Sklad
                        </h2>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="btn btn-primary btn-small"
                        >
                            {showForm ? '‚ùå' : '‚ûï'}
                        </button>
                    </div>

                    {/* Tabs for Fabrics vs Decorations */}
                    <div className="flex gap-2 bg-white rounded-lg p-1 card-shadow">
                        <button
                            onClick={() => {
                                setInventoryTab('fabrics');
                                setShowForm(false);
                                resetForm();
                            }}
                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${
                                inventoryTab === 'fabrics' 
                                    ? 'bg-gradient-to-r from-stone-700 to-stone-600 text-white' 
                                    : 'text-stone-600 hover:bg-stone-50'
                            }`}
                        >
                            üßµ L√°tky
                        </button>
                        <button
                            onClick={() => {
                                setInventoryTab('decorations');
                                setShowForm(false);
                                resetForm();
                            }}
                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${
                                inventoryTab === 'decorations' 
                                    ? 'bg-gradient-to-r from-stone-700 to-stone-600 text-white' 
                                    : 'text-stone-600 hover:bg-stone-50'
                            }`}
                        >
                            ‚ú® Zdoben√≠
                        </button>
                    </div>

                    {/* Add/Edit Form */}
                    {showForm && (
                        <div className="card">
                            <h3 className="font-semibold mb-4">
                                {editingId 
                                    ? `‚úèÔ∏è Upravit ${inventoryTab === 'fabrics' ? 'l√°tku' : 'zdoben√≠'}` 
                                    : `‚ûï Nov√° ${inventoryTab === 'fabrics' ? 'l√°tka' : 'zdoben√≠'}`}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-3">
                                    <div className="form-group">
                                        <label className="form-label">N√°zev *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="form-input"
                                            placeholder={inventoryTab === 'fabrics' ? 'nap≈ô. Bavlnƒõn√° l√°tka' : 'nap≈ô. Krajka, Knofl√≠ky'}
                                        />
                                    </div>

                                    {inventoryTab === 'fabrics' && (
                                        <div className="form-group">
                                            <label className="form-label">Typ *</label>
                                            <input
                                                type="text"
                                                required
                                                value={formData.type}
                                                onChange={(e) => setFormData({...formData, type: e.target.value})}
                                                className="form-input"
                                                placeholder="nap≈ô. Bavlna, Hedv√°b√≠"
                                            />
                                        </div>
                                    )}

                                    <div className="grid grid-2 gap-3">
                                        <div className="form-group">
                                            <label className="form-label">
                                                {inventoryTab === 'fabrics' ? 'Mno≈æstv√≠ (m¬≤) *' : 'Mno≈æstv√≠ *'}
                                            </label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                required
                                                value={formData.quantity}
                                                onChange={(e) => setFormData({...formData, quantity: e.target.value})}
                                                className="form-input"
                                                placeholder="0.00"
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">
                                                {inventoryTab === 'fabrics' ? 'Cena za m¬≤ (Kƒç) *' : 'Cena za kus/m (Kƒç) *'}
                                            </label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                required
                                                value={formData.pricePerM2}
                                                onChange={(e) => setFormData({...formData, pricePerM2: e.target.value})}
                                                className="form-input"
                                                placeholder="0.00"
                                            />
                                        </div>
                                    </div>

                                    {inventoryTab === 'decorations' && (
                                        <div className="form-group">
                                            <label className="form-label">Jednotka *</label>
                                            <select
                                                value={formData.unit}
                                                onChange={(e) => setFormData({...formData, unit: e.target.value})}
                                                className="form-select"
                                                required
                                            >
                                                <option value="ks">kusy (ks)</option>
                                                <option value="m">metry (m)</option>
                                            </select>
                                        </div>
                                    )}

                                    <div className="form-group">
                                        <label className="form-label">Barva</label>
                                        <input
                                            type="text"
                                            value={formData.color}
                                            onChange={(e) => setFormData({...formData, color: e.target.value})}
                                            className="form-input"
                                            placeholder="nap≈ô. B√≠l√°, Zlat√°"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Obr√°zek (max 2MB)</label>
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={handleImageUpload}
                                            className="form-input"
                                        />
                                        {formData.image && (
                                            <div className="mt-2">
                                                <img src={formData.image} alt="Preview" style={{width: '100%', maxHeight: '150px', objectFit: 'cover', borderRadius: '0.5rem'}} />
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="flex gap-2 mt-4">
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="btn btn-secondary flex-1"
                                    >
                                        Zru≈°it
                                    </button>
                                    <button
                                        type="submit"
                                        className="btn btn-primary flex-1"
                                    >
                                        {editingId ? 'Ulo≈æit' : 'P≈ôidat'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Items Grid - Fabrics */}
                    {inventoryTab === 'fabrics' && (
                        <>
                            {fabrics.length === 0 ? (
                                <div className="card">
                                    <div className="empty-state">
                                        <div className="empty-icon">üì¶</div>
                                        <p>Zat√≠m nem√°te ≈æ√°dn√© l√°tky na skladƒõ</p>
                                        <p className="text-xs mt-2">Kliknƒõte na ‚ûï pro p≈ôid√°n√≠</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="grid grid-2">
                                    {fabrics.map(fabric => {
                                        const isUsed = isItemUsedInOrders(fabric.id, 'fabric');
                                        return (
                                        <div key={fabric.id} className="fabric-card" style={{opacity: isUsed ? 0.7 : 1, position: 'relative'}}>
                                            {isUsed && (
                                                <div style={{
                                                    position: 'absolute',
                                                    top: '8px',
                                                    right: '8px',
                                                    background: '#ef4444',
                                                    color: 'white',
                                                    padding: '4px 8px',
                                                    borderRadius: '6px',
                                                    fontSize: '0.7rem',
                                                    fontWeight: '600',
                                                    zIndex: 10,
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                                                }}>
                                                    üîí Pou≈æito
                                                </div>
                                            )}
                                            {fabric.image && (
                                                <div className="fabric-image">
                                                    <img src={fabric.image} alt={fabric.name} />
                                                </div>
                                            )}
                                            <div className="fabric-content">
                                                <h3 className="fabric-name">{fabric.name}</h3>
                                                <div className="space-y-1">
                                                    <div className="fabric-info">
                                                        <span>Typ:</span>
                                                        <span className="font-medium">{fabric.type}</span>
                                                    </div>
                                                    <div className="fabric-info">
                                                        <span>Mno≈æstv√≠:</span>
                                                        <span className="font-medium">{fabric.quantity} m¬≤</span>
                                                    </div>
                                                    <div className="fabric-info">
                                                        <span>Cena/m¬≤:</span>
                                                        <span className="font-medium">{formatCurrency(fabric.pricePerM2)}</span>
                                                    </div>
                                                    {fabric.color && (
                                                        <div className="fabric-info">
                                                            <span>Barva:</span>
                                                            <span className="font-medium">{fabric.color}</span>
                                                        </div>
                                                    )}
                                                    <div className="fabric-info border-t pt-1 font-semibold">
                                                        <span>Hodnota:</span>
                                                        <span>{formatCurrency(fabric.quantity * fabric.pricePerM2)}</span>
                                                    </div>
                                                </div>
                                                <div className="fabric-actions">
                                                    <button
                                                        onClick={() => handleEdit(fabric, 'fabric')}
                                                        className="btn btn-secondary flex-1 btn-small"
                                                    >
                                                        ‚úèÔ∏è
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(fabric.id, 'fabric')}
                                                        className="btn btn-danger flex-1 btn-small"
                                                        disabled={isUsed}
                                                        style={{opacity: isUsed ? 0.5 : 1}}
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    )})}
                                </div>
                            )}
                        </>
                    )}

                    {/* Items Grid - Decorations */}
                    {inventoryTab === 'decorations' && (
                        <>
                            {(!decorations || decorations.length === 0) ? (
                                <div className="card">
                                    <div className="empty-state">
                                        <div className="empty-icon">‚ú®</div>
                                        <p>Zat√≠m nem√°te ≈æ√°dn√© zdoben√≠ na skladƒõ</p>
                                        <p className="text-xs mt-2">Kliknƒõte na ‚ûï pro p≈ôid√°n√≠</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="grid grid-2">
                                    {decorations.map(decoration => {
                                        const isUsed = isItemUsedInOrders(decoration.id, 'decoration');
                                        return (
                                        <div key={decoration.id} className="fabric-card" style={{opacity: isUsed ? 0.7 : 1, position: 'relative'}}>
                                            {isUsed && (
                                                <div style={{
                                                    position: 'absolute',
                                                    top: '8px',
                                                    right: '8px',
                                                    background: '#ef4444',
                                                    color: 'white',
                                                    padding: '4px 8px',
                                                    borderRadius: '6px',
                                                    fontSize: '0.7rem',
                                                    fontWeight: '600',
                                                    zIndex: 10,
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                                                }}>
                                                    üîí Pou≈æito
                                                </div>
                                            )}
                                            {decoration.image && (
                                                <div className="fabric-image">
                                                    <img src={decoration.image} alt={decoration.name} />
                                                </div>
                                            )}
                                            <div className="fabric-content">
                                                <h3 className="fabric-name">{decoration.name}</h3>
                                                <div className="space-y-1">
                                                    <div className="fabric-info">
                                                        <span>Mno≈æstv√≠:</span>
                                                        <span className="font-medium">{decoration.quantity} {decoration.unit}</span>
                                                    </div>
                                                    <div className="fabric-info">
                                                        <span>Cena/{decoration.unit}:</span>
                                                        <span className="font-medium">{formatCurrency(decoration.price)}</span>
                                                    </div>
                                                    {decoration.color && (
                                                        <div className="fabric-info">
                                                            <span>Barva:</span>
                                                            <span className="font-medium">{decoration.color}</span>
                                                        </div>
                                                    )}
                                                    <div className="fabric-info border-t pt-1 font-semibold">
                                                        <span>Hodnota:</span>
                                                        <span>{formatCurrency(decoration.quantity * decoration.price)}</span>
                                                    </div>
                                                </div>
                                                <div className="fabric-actions">
                                                    <button
                                                        onClick={() => handleEdit(decoration, 'decoration')}
                                                        className="btn btn-secondary flex-1 btn-small"
                                                    >
                                                        ‚úèÔ∏è
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(decoration.id, 'decoration')}
                                                        className="btn btn-danger flex-1 btn-small"
                                                        disabled={isUsed}
                                                        style={{opacity: isUsed ? 0.5 : 1}}
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    )})}
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        };

        // Orders Component
        const Orders = ({ orders, setOrders, fabrics, decorations, rates, showToast }) => {
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                customer: '',
                preparationTime: '',
                seamstressTime: '',
                salePrice: '',
                selectedFabrics: [],
                selectedDecorations: [],
                extras: [],
                images: [],
                notes: '',
                color: '#8b7460'
            });

            // Color palette for orders
            const orderColors = [
                { name: 'Hnƒõd√°', value: '#8b7460', light: '#f5f1eb' },
                { name: 'Modr√°', value: '#3b82f6', light: '#dbeafe' },
                { name: 'Zelen√°', value: '#10b981', light: '#d1fae5' },
                { name: 'ƒåerven√°', value: '#ef4444', light: '#fee2e2' },
                { name: 'Fialov√°', value: '#8b5cf6', light: '#ede9fe' },
                { name: 'R≈Ø≈æov√°', value: '#ec4899', light: '#fce7f3' },
                { name: 'Oran≈æov√°', value: '#f59e0b', light: '#fef3c7' },
                { name: '≈†ed√°', value: '#6b7280', light: '#f3f4f6' }
            ];

            const handleSubmit = (e) => {
                e.preventDefault();
                
                const orderData = {
                    ...formData,
                    id: editingId || Date.now().toString(),
                    preparationTime: parseFloat(formData.preparationTime) || 0,
                    seamstressTime: parseFloat(formData.seamstressTime) || 0,
                    salePrice: parseFloat(formData.salePrice) || 0,
                    preparationRate: rates.preparation,
                    seamstressRate: rates.seamstress,
                    status: editingId ? orders.find(o => o.id === editingId)?.status || 'active' : 'active',
                    createdAt: editingId ? orders.find(o => o.id === editingId)?.createdAt : new Date().toISOString(),
                    completedAt: editingId ? orders.find(o => o.id === editingId)?.completedAt : null
                };

                orderData.fabrics = orderData.selectedFabrics.map(sf => {
                    const fabric = fabrics.find(f => f.id === sf.fabricId);
                    return {
                        ...sf,
                        fabricId: sf.fabricId,
                        name: fabric?.name,
                        pricePerM2: fabric?.pricePerM2,
                        totalCost: sf.quantity * (fabric?.pricePerM2 || 0)
                    };
                });

                orderData.decorations = orderData.selectedDecorations.map(sd => {
                    const decoration = decorations?.find(d => d.id === sd.decorationId);
                    return {
                        ...sd,
                        decorationId: sd.decorationId,
                        name: decoration?.name,
                        price: decoration?.price,
                        unit: decoration?.unit,
                        totalCost: sd.quantity * (decoration?.price || 0)
                    };
                });

                if (editingId) {
                    setOrders(orders.map(o => o.id === editingId ? orderData : o));
                    showToast('‚úÖ Zak√°zka aktualizov√°na');
                } else {
                    setOrders([...orders, orderData]);
                    showToast('‚úÖ Zak√°zka vytvo≈ôena');
                }
                
                resetForm();
            };

            const handleEdit = (order) => {
                setFormData({
                    name: order.name,
                    customer: order.customer || '',
                    preparationTime: order.preparationTime.toString(),
                    seamstressTime: order.seamstressTime.toString(),
                    salePrice: order.salePrice ? order.salePrice.toString() : '',
                    selectedFabrics: order.fabrics?.map(f => ({
                        fabricId: f.fabricId || fabrics.find(fab => fab.name === f.name)?.id || '',
                        quantity: f.quantity
                    })) || [],
                    selectedDecorations: order.decorations?.map(d => ({
                        decorationId: d.decorationId || decorations?.find(dec => dec.name === d.name)?.id || '',
                        quantity: d.quantity
                    })) || [],
                    extras: order.extras || [],
                    images: order.images || [],
                    notes: order.notes || '',
                    color: order.color || '#8b7460'
                });
                setEditingId(order.id);
                setShowForm(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    customer: '',
                    preparationTime: '',
                    seamstressTime: '',
                    salePrice: '',
                    selectedFabrics: [],
                    selectedDecorations: [],
                    extras: [],
                    images: [],
                    notes: '',
                    color: '#8b7460'
                });
                setEditingId(null);
                setShowForm(false);
            };

            const addDecoration = () => {
                setFormData({
                    ...formData,
                    selectedDecorations: [...formData.selectedDecorations, { decorationId: '', quantity: '' }]
                });
            };

            const removeDecoration = (index) => {
                setFormData({
                    ...formData,
                    selectedDecorations: formData.selectedDecorations.filter((_, i) => i !== index)
                });
            };

            const updateDecoration = (index, field, value) => {
                const updated = [...formData.selectedDecorations];
                updated[index] = { ...updated[index], [field]: value };
                setFormData({ ...formData, selectedDecorations: updated });
            };

            const addFabric = () => {
                setFormData({
                    ...formData,
                    selectedFabrics: [...formData.selectedFabrics, { fabricId: '', quantity: '' }]
                });
            };

            const removeFabric = (index) => {
                setFormData({
                    ...formData,
                    selectedFabrics: formData.selectedFabrics.filter((_, i) => i !== index)
                });
            };

            const updateFabric = (index, field, value) => {
                const updated = [...formData.selectedFabrics];
                updated[index] = { ...updated[index], [field]: value };
                setFormData({ ...formData, selectedFabrics: updated });
            };

            const addExtra = () => {
                setFormData({
                    ...formData,
                    extras: [...formData.extras, { name: '', price: '' }]
                });
            };

            const removeExtra = (index) => {
                setFormData({
                    ...formData,
                    extras: formData.extras.filter((_, i) => i !== index)
                });
            };

            const updateExtra = (index, field, value) => {
                const updated = [...formData.extras];
                updated[index] = { ...updated[index], [field]: value };
                setFormData({ ...formData, extras: updated });
            };

            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                if (files.length + formData.images.length > 6) {
                    alert('‚ö†Ô∏è Maxim√°lnƒõ 6 obr√°zk≈Ø');
                    return;
                }
                
                const readers = files.map(file => {
                    if (file.size > 2000000) {
                        alert('‚ö†Ô∏è Nƒõkter√© obr√°zky jsou p≈ô√≠li≈° velk√© (max 2MB)');
                        return Promise.resolve(null);
                    }
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(file);
                    });
                });

                Promise.all(readers).then(images => {
                    const validImages = images.filter(img => img !== null);
                    setFormData({
                        ...formData,
                        images: [...formData.images, ...validImages]
                    });
                });
            };

            const removeImage = (index) => {
                setFormData({
                    ...formData,
                    images: formData.images.filter((_, i) => i !== index)
                });
            };

            const calculateTotal = () => {
                const fabricsCost = formData.selectedFabrics.reduce((sum, sf) => {
                    const fabric = fabrics.find(f => f.id === sf.fabricId);
                    return sum + (parseFloat(sf.quantity) || 0) * (fabric?.pricePerM2 || 0);
                }, 0);

                const decorationsCost = formData.selectedDecorations.reduce((sum, sd) => {
                    const decoration = decorations?.find(d => d.id === sd.decorationId);
                    return sum + (parseFloat(sd.quantity) || 0) * (decoration?.price || 0);
                }, 0);

                const prepCost = (parseFloat(formData.preparationTime) || 0) * rates.preparation;
                const seamCost = (parseFloat(formData.seamstressTime) || 0) * rates.seamstress;
                const extrasCost = formData.extras.reduce((sum, e) => sum + (parseFloat(e.price) || 0), 0);
                const totalCosts = fabricsCost + decorationsCost + prepCost + seamCost + extrasCost;
                
                const salePrice = parseFloat(formData.salePrice) || 0;
                const marginAmount = salePrice - totalCosts;
                const marginPercent = totalCosts > 0 ? (marginAmount / totalCosts) * 100 : 0;

                return { 
                    fabricsCost, 
                    decorationsCost, 
                    prepCost, 
                    seamCost, 
                    extrasCost, 
                    totalCosts, 
                    salePrice,
                    marginAmount,
                    marginPercent
                };
            };

            const costs = calculateTotal();

            return (
                <div className="fade-in space-y-4">
                    <div className="flex items-center justify-between">
                        <h2 className="text-xl heading-font font-semibold">
                            Zak√°zky
                        </h2>
                        <button
                            onClick={() => {
                                setShowForm(!showForm);
                                if (!showForm) window.scrollTo({ top: 0, behavior: 'smooth' });
                            }}
                            className="btn btn-primary btn-small"
                        >
                            {showForm ? '‚ùå' : '‚ûï'}
                        </button>
                    </div>

                    {/* Order Form */}
                    {showForm && (
                        <div className="card">
                            <h3 className="font-semibold mb-4">
                                {editingId ? '‚úèÔ∏è Upravit zak√°zku' : '‚ûï Nov√° zak√°zka'}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-3">
                                    <div className="form-group">
                                        <label className="form-label">N√°zev zak√°zky *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="form-input"
                                            placeholder="nap≈ô. Svatebn√≠ ≈°aty"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Z√°kazn√≠k</label>
                                        <input
                                            type="text"
                                            value={formData.customer}
                                            onChange={(e) => setFormData({...formData, customer: e.target.value})}
                                            className="form-input"
                                            placeholder="Jm√©no z√°kazn√≠ka"
                                        />
                                    </div>

                                    {/* Fabrics Section */}
                                    <div className="border-t pt-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="font-semibold text-sm">üì¶ L√°tky</h4>
                                            <button
                                                type="button"
                                                onClick={addFabric}
                                                className="btn btn-secondary btn-small"
                                            >
                                                ‚ûï
                                            </button>
                                        </div>
                                        {formData.selectedFabrics.map((sf, index) => (
                                            <div key={index} className="space-y-2 mb-3 list-item">
                                                <select
                                                    value={sf.fabricId}
                                                    onChange={(e) => updateFabric(index, 'fabricId', e.target.value)}
                                                    className="form-select"
                                                    required
                                                >
                                                    <option value="">Vyberte l√°tku</option>
                                                    {fabrics.map(fabric => (
                                                        <option key={fabric.id} value={fabric.id}>
                                                            {fabric.name} ({fabric.quantity} m¬≤)
                                                        </option>
                                                    ))}
                                                </select>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={sf.quantity}
                                                        onChange={(e) => updateFabric(index, 'quantity', e.target.value)}
                                                        className="form-input flex-1"
                                                        placeholder="m¬≤"
                                                        required
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removeFabric(index)}
                                                        className="btn btn-danger btn-small"
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Decorations Section */}
                                    <div className="border-t pt-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="font-semibold text-sm">‚ú® Zdoben√≠</h4>
                                            <button
                                                type="button"
                                                onClick={addDecoration}
                                                className="btn btn-secondary btn-small"
                                            >
                                                ‚ûï
                                            </button>
                                        </div>
                                        {formData.selectedDecorations.map((sd, index) => (
                                            <div key={index} className="space-y-2 mb-3 list-item">
                                                <select
                                                    value={sd.decorationId}
                                                    onChange={(e) => updateDecoration(index, 'decorationId', e.target.value)}
                                                    className="form-select"
                                                    required
                                                >
                                                    <option value="">Vyberte zdoben√≠</option>
                                                    {decorations?.map(decoration => (
                                                        <option key={decoration.id} value={decoration.id}>
                                                            {decoration.name} ({decoration.quantity} {decoration.unit})
                                                        </option>
                                                    ))}
                                                </select>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={sd.quantity}
                                                        onChange={(e) => updateDecoration(index, 'quantity', e.target.value)}
                                                        className="form-input flex-1"
                                                        placeholder="Mno≈æstv√≠"
                                                        required
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removeDecoration(index)}
                                                        className="btn btn-danger btn-small"
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Time Tracking */}
                                    <div className="border-t pt-3">
                                        <h4 className="font-semibold text-sm mb-2">‚è±Ô∏è ƒåas</h4>
                                        <div className="space-y-2">
                                            <div className="form-group">
                                                <label className="form-label">P≈ô√≠prava (hodiny)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={formData.preparationTime}
                                                    onChange={(e) => setFormData({...formData, preparationTime: e.target.value})}
                                                    className="form-input"
                                                    placeholder="0.0"
                                                />
                                                <p className="text-xs text-gray mt-1">
                                                    {formatCurrency(rates.preparation)}/hod
                                                </p>
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">≈†vadlena (hodiny)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={formData.seamstressTime}
                                                    onChange={(e) => setFormData({...formData, seamstressTime: e.target.value})}
                                                    className="form-input"
                                                    placeholder="0.0"
                                                />
                                                <p className="text-xs text-gray mt-1">
                                                    {formatCurrency(rates.seamstress)}/hod
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Extras */}
                                    <div className="border-t pt-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="font-semibold text-sm">üîß V√≠cepr√°ce</h4>
                                            <button
                                                type="button"
                                                onClick={addExtra}
                                                className="btn btn-secondary btn-small"
                                            >
                                                ‚ûï
                                            </button>
                                        </div>
                                        {formData.extras.map((extra, index) => (
                                            <div key={index} className="space-y-2 mb-3 list-item">
                                                <input
                                                    type="text"
                                                    value={extra.name}
                                                    onChange={(e) => updateExtra(index, 'name', e.target.value)}
                                                    className="form-input"
                                                    placeholder="N√°zev pr√°ce"
                                                    required
                                                />
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={extra.price}
                                                        onChange={(e) => updateExtra(index, 'price', e.target.value)}
                                                        className="form-input flex-1"
                                                        placeholder="Kƒç"
                                                        required
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removeExtra(index)}
                                                        className="btn btn-danger btn-small"
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Sale Price */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">üí∞ Prodejn√≠ cena (Kƒç) *</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                required
                                                value={formData.salePrice}
                                                onChange={(e) => setFormData({...formData, salePrice: e.target.value})}
                                                className="form-input"
                                                placeholder="0.00"
                                            />
                                            <p className="text-xs text-gray mt-1">
                                                Fin√°ln√≠ cena, za kterou prod√°v√°te zak√°zku z√°kazn√≠kovi
                                            </p>
                                        </div>
                                    </div>

                                    {/* Color Picker */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">üé® Barva zak√°zky</label>
                                            <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                {orderColors.map(color => (
                                                    <button
                                                        key={color.value}
                                                        type="button"
                                                        onClick={() => setFormData({...formData, color: color.value})}
                                                        style={{
                                                            width: '3rem',
                                                            height: '3rem',
                                                            borderRadius: '0.75rem',
                                                            border: formData.color === color.value ? '3px solid #000' : '2px solid #d6d3d1',
                                                            background: color.value,
                                                            cursor: 'pointer',
                                                            transform: formData.color === color.value ? 'scale(1.1)' : 'scale(1)',
                                                            transition: 'all 0.2s',
                                                            boxShadow: formData.color === color.value ? '0 4px 8px rgba(0,0,0,0.2)' : '0 2px 4px rgba(0,0,0,0.1)'
                                                        }}
                                                        title={color.name}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Images */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">üì∑ Fotografie (max 6, 2MB)</label>
                                            <input
                                                type="file"
                                                multiple
                                                accept="image/*"
                                                onChange={handleImageUpload}
                                                className="form-input"
                                            />
                                        </div>
                                        {formData.images.length > 0 && (
                                            <div className="image-grid">
                                                {formData.images.map((img, index) => (
                                                    <div key={index} className="image-preview">
                                                        <img src={img} alt={`N√°hled ${index + 1}`} />
                                                        <button
                                                            type="button"
                                                            onClick={() => removeImage(index)}
                                                            className="image-remove"
                                                        >
                                                            ‚ùå
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Notes */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">üìù Pozn√°mky</label>
                                            <textarea
                                                value={formData.notes}
                                                onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                                className="form-textarea"
                                                placeholder="Dal≈°√≠ pozn√°mky..."
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Cost Summary */}
                                <div className="summary-section">
                                    <h4 className="font-semibold mb-2">üíµ Kalkulace</h4>
                                    <div className="summary-row">
                                        <span>L√°tky:</span>
                                        <span>{formatCurrency(costs.fabricsCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>Zdoben√≠:</span>
                                        <span>{formatCurrency(costs.decorationsCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>P≈ô√≠prava:</span>
                                        <span>{formatCurrency(costs.prepCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>≈†vadlena:</span>
                                        <span>{formatCurrency(costs.seamCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>V√≠cepr√°ce:</span>
                                        <span>{formatCurrency(costs.extrasCost)}</span>
                                    </div>
                                    <div className="summary-row border-t pt-2 font-semibold">
                                        <span>Celkov√© n√°klady:</span>
                                        <span>{formatCurrency(costs.totalCosts)}</span>
                                    </div>
                                    <div className="summary-total" style={{background: '#f0fdf4', borderRadius: '0.5rem', padding: '0.75rem', marginTop: '0.75rem', border: '2px solid #10b981'}}>
                                        <span>Prodejn√≠ cena:</span>
                                        <span style={{color: '#10b981'}}>{formatCurrency(costs.salePrice)}</span>
                                    </div>
                                    <div className="summary-row" style={{fontSize: '0.875rem', marginTop: '0.5rem'}}>
                                        <span>Mar≈æe:</span>
                                        <span className={costs.marginAmount >= 0 ? 'text-green' : 'text-red'} style={{fontWeight: '600'}}>
                                            {formatCurrency(costs.marginAmount)} ({costs.marginPercent.toFixed(1)}%)
                                        </span>
                                    </div>
                                </div>

                                <div className="flex gap-2 mt-3">
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="btn btn-secondary flex-1"
                                    >
                                        Zru≈°it
                                    </button>
                                    <button
                                        type="submit"
                                        className="btn btn-primary flex-1"
                                    >
                                        {editingId ? 'Ulo≈æit zmƒõny' : 'Vytvo≈ôit'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Active Orders List */}
                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            üõçÔ∏è Aktivn√≠ zak√°zky
                        </h3>
                        {orders.filter(o => o.status === 'active').length === 0 ? (
                            <div className="empty-state">
                                <p className="text-sm">≈Ω√°dn√© aktivn√≠ zak√°zky</p>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {orders.filter(o => o.status === 'active').map(order => (
                                    <OrderCard 
                                        key={order.id} 
                                        order={order} 
                                        orders={orders}
                                        setOrders={setOrders}
                                        showToast={showToast}
                                        onEdit={handleEdit}
                                    />
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Order Card Component
        const OrderCard = ({ order, orders, setOrders, showToast, onEdit }) => {
            const [expanded, setExpanded] = useState(false);

            const markComplete = () => {
                if (window.confirm('Oznaƒçit jako dokonƒçenou?')) {
                    setOrders(orders.map(o => 
                        o.id === order.id ? { ...o, status: 'completed', completedAt: new Date().toISOString() } : o
                    ));
                    showToast('‚úÖ Zak√°zka dokonƒçena');
                }
            };

            const deleteOrder = () => {
                if (window.confirm('Opravdu smazat?')) {
                    setOrders(orders.filter(o => o.id !== order.id));
                    showToast('‚úÖ Zak√°zka smaz√°na');
                }
            };

            const handleEdit = () => {
                onEdit(order);
            };

            const total = calculateOrderTotal(order);

            return (
                <div 
                    className="order-card" 
                    style={{
                        borderLeft: `5px solid ${order.color || '#8b7460'}`,
                        background: `linear-gradient(to right, ${order.color || '#8b7460'}08 0%, transparent 100%)`
                    }}
                >
                    <div className="order-header" onClick={() => setExpanded(!expanded)}>
                        <div className="flex-1 min-w-0">
                            <h4 className="font-semibold text-sm truncate">{order.name}</h4>
                            <p className="text-xs text-gray mt-1">
                                {order.customer && `${order.customer} ‚Ä¢ `}
                                {formatDate(order.createdAt)}
                            </p>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="text-right">
                                <p className="font-bold text-sm">{formatCurrency(total)}</p>
                            </div>
                            <div className="text-lg">
                                {expanded ? 'üîº' : 'üîΩ'}
                            </div>
                        </div>
                    </div>

                    {expanded && (
                        <div className="order-details space-y-3">
                            {/* Color indicator header */}
                            <div 
                                style={{
                                    background: `linear-gradient(135deg, ${order.color || '#8b7460'} 0%, ${order.color || '#a89380'} 100%)`,
                                    margin: '-1rem -1rem 1rem -1rem',
                                    padding: '0.5rem 1rem',
                                    borderRadius: '0.75rem 0.75rem 0 0',
                                    color: 'white',
                                    fontWeight: '600',
                                    fontSize: '0.75rem'
                                }}
                            >
                                Zak√°zka
                            </div>

                            {/* Fabrics */}
                            {order.fabrics && order.fabrics.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üì¶ L√°tky</h5>
                                    {order.fabrics.map((f, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{f.name} ({f.quantity} m¬≤)</span>
                                            <span>{formatCurrency(f.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Decorations */}
                            {order.decorations && order.decorations.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">‚ú® Zdoben√≠</h5>
                                    {order.decorations.map((d, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{d.name} ({d.quantity} {d.unit})</span>
                                            <span>{formatCurrency(d.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Time */}
                            <div>
                                <h5 className="font-medium text-sm mb-1">‚è±Ô∏è ƒåas</h5>
                                <div className="flex justify-between text-xs text-gray mb-1">
                                    <span>P≈ô√≠prava ({order.preparationTime}h)</span>
                                    <span>{formatCurrency(order.preparationTime * order.preparationRate)}</span>
                                </div>
                                <div className="flex justify-between text-xs text-gray">
                                    <span>≈†vadlena ({order.seamstressTime}h)</span>
                                    <span>{formatCurrency(order.seamstressTime * order.seamstressRate)}</span>
                                </div>
                            </div>

                            {/* Extras */}
                            {order.extras && order.extras.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üîß V√≠cepr√°ce</h5>
                                    {order.extras.map((e, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{e.name}</span>
                                            <span>{formatCurrency(e.price)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Images */}
                            {order.images && order.images.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üì∑ Fotografie</h5>
                                    <div className="image-grid">
                                        {order.images.map((img, i) => (
                                            <img 
                                                key={i}
                                                src={img}
                                                alt={`Foto ${i + 1}`}
                                                style={{width: '100%', height: '5rem', objectFit: 'cover', borderRadius: '0.5rem', cursor: 'pointer'}}
                                                onClick={() => window.open(img, '_blank')}
                                            />
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Notes */}
                            {order.notes && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üìù Pozn√°mky</h5>
                                    <p className="text-xs text-gray">{order.notes}</p>
                                </div>
                            )}

                            {/* Actions */}
                            <div className="flex gap-2 border-t pt-3">
                                <button
                                    onClick={handleEdit}
                                    className="btn btn-secondary flex-1 btn-small"
                                >
                                    ‚úèÔ∏è Upravit
                                </button>
                                <button
                                    onClick={markComplete}
                                    className="btn btn-success flex-1 btn-small"
                                >
                                    ‚úÖ Dokonƒçit
                                </button>
                                <button
                                    onClick={deleteOrder}
                                    className="btn btn-danger btn-small"
                                >
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // History Component
        const History = ({ orders, setOrders, showToast }) => {
            const [filter, setFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');

            const filteredOrders = orders.filter(order => {
                const matchesFilter = filter === 'all' || order.status === filter;
                const matchesSearch = order.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     order.customer?.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            const exportOrder = (order) => {
                const total = calculateOrderTotal(order);
                const costs = calculateOrderCosts(order);

                let text = `ZAK√ÅZKA: ${order.name}\n`;
                text += `========================================\n`;
                text += `Z√°kazn√≠k: ${order.customer || 'N/A'}\n`;
                text += `Vytvo≈ôeno: ${formatDate(order.createdAt)}\n`;
                if (order.completedAt) {
                    text += `Dokonƒçeno: ${formatDate(order.completedAt)}\n`;
                }
                text += `\nL√ÅTKY:\n`;
                order.fabrics?.forEach(f => {
                    text += `- ${f.name}: ${f.quantity} m¬≤ √ó ${formatCurrency(f.pricePerM2)} = ${formatCurrency(f.totalCost)}\n`;
                });
                text += `\nƒåAS:\n`;
                text += `- P≈ô√≠prava: ${order.preparationTime}h √ó ${formatCurrency(order.preparationRate)} = ${formatCurrency(order.preparationTime * order.preparationRate)}\n`;
                text += `- ≈†vadlena: ${order.seamstressTime}h √ó ${formatCurrency(order.seamstressRate)} = ${formatCurrency(order.seamstressTime * order.seamstressRate)}\n`;
                if (order.extras?.length > 0) {
                    text += `\nV√çCEPR√ÅCE:\n`;
                    order.extras.forEach(e => {
                        text += `- ${e.name}: ${formatCurrency(e.price)}\n`;
                    });
                }
                text += `\n========================================\n`;
                text += `N√°klady: ${formatCurrency(costs)}\n`;
                text += `CELKEM: ${formatCurrency(total)}\n`;
                text += `ZISK: ${formatCurrency(total - costs)}\n`;

                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `zakazka-${order.name.replace(/\s+/g, '-')}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('‚úÖ Zak√°zka exportov√°na');
            };

            return (
                <div className="fade-in space-y-4">
                    <h2 className="text-xl heading-font font-semibold">
                        üìú Historie
                    </h2>

                    <div className="space-y-2">
                        <input
                            type="text"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            placeholder="üîç Hledat..."
                            className="form-input"
                        />
                        <select
                            value={filter}
                            onChange={(e) => setFilter(e.target.value)}
                            className="form-select"
                        >
                            <option value="all">V≈°echny zak√°zky</option>
                            <option value="active">Aktivn√≠</option>
                            <option value="completed">Dokonƒçen√©</option>
                        </select>
                    </div>

                    {filteredOrders.length === 0 ? (
                        <div className="card">
                            <div className="empty-state">
                                <div className="empty-icon">üîç</div>
                                <p>Nenalezeny ≈æ√°dn√© zak√°zky</p>
                            </div>
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {filteredOrders.map(order => (
                                <HistoryOrderCard 
                                    key={order.id}
                                    order={order}
                                    exportOrder={exportOrder}
                                    setOrders={setOrders}
                                    showToast={showToast}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // History Order Card Component with expandable details
        const HistoryOrderCard = ({ order, exportOrder, setOrders, showToast }) => {
            const [expanded, setExpanded] = useState(false);
            const total = calculateOrderTotal(order);
            const costs = calculateOrderCosts(order);
            const profit = total - costs;

            const reactivateOrder = () => {
                if (window.confirm('Obnovit zak√°zku jako aktivn√≠?')) {
                    setOrders(prevOrders => prevOrders.map(o => 
                        o.id === order.id ? { ...o, status: 'active', completedAt: null } : o
                    ));
                    showToast('‚úÖ Zak√°zka obnovena');
                }
            };

            return (
                <div 
                    className="card" 
                    style={{
                        borderLeft: `5px solid ${order.color || '#8b7460'}`,
                        background: `linear-gradient(to right, ${order.color || '#8b7460'}08 0%, transparent 100%)`
                    }}
                >
                    <div 
                        className="flex items-start justify-between gap-3 cursor-pointer"
                        onClick={() => setExpanded(!expanded)}
                    >
                        <div className="flex items-center gap-2 flex-1 min-w-0">
                            <div className="text-xl">
                                {order.status === 'active' ? '‚è≥' : '‚úÖ'}
                            </div>
                            <div className="min-w-0 flex-1">
                                <h3 className="font-semibold text-sm truncate">{order.name}</h3>
                                <p className="text-xs text-gray">
                                    {order.customer && `${order.customer} ‚Ä¢ `}
                                    {formatDate(order.createdAt)}
                                    {order.completedAt && ` ‚Ä¢ Dokonƒçeno: ${formatDate(order.completedAt)}`}
                                </p>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="text-lg">
                                {expanded ? 'üîº' : 'üîΩ'}
                            </div>
                        </div>
                    </div>

                    {!expanded && (
                        <div className="grid grid-2 gap-2 list-item mt-3">
                            <div className="text-center">
                                <p className="text-xs text-gray">Celkem</p>
                                <p className="font-semibold text-sm">
                                    {formatCurrency(total)}
                                </p>
                            </div>
                            <div className="text-center">
                                <p className="text-xs text-gray">Zisk</p>
                                <p className="font-semibold text-sm text-green">
                                    {formatCurrency(profit)}
                                </p>
                            </div>
                        </div>
                    )}

                    {expanded && (
                        <div className="order-details space-y-3 mt-3 pt-3 border-t">
                            {/* Color indicator header */}
                            <div 
                                style={{
                                    background: `linear-gradient(135deg, ${order.color || '#8b7460'} 0%, ${order.color || '#a89380'} 100%)`,
                                    margin: '-1rem -1rem 1rem -1rem',
                                    padding: '0.5rem 1rem',
                                    borderRadius: '0.75rem 0.75rem 0 0',
                                    color: 'white',
                                    fontWeight: '600',
                                    fontSize: '0.75rem'
                                }}
                            >
                                {order.status === 'active' ? '‚è≥ Aktivn√≠ zak√°zka' : '‚úÖ Dokonƒçen√° zak√°zka'}
                            </div>

                            {/* Summary Stats */}
                            <div className="grid grid-3 gap-2 mb-3">
                                <div className="text-center list-item">
                                    <p className="text-xs text-gray">Celkem</p>
                                    <p className="font-semibold text-sm">{formatCurrency(total)}</p>
                                </div>
                                <div className="text-center list-item">
                                    <p className="text-xs text-gray">N√°klady</p>
                                    <p className="font-semibold text-sm">{formatCurrency(costs)}</p>
                                </div>
                                <div className="text-center list-item">
                                    <p className="text-xs text-gray">Zisk</p>
                                    <p className="font-semibold text-sm text-green">{formatCurrency(profit)}</p>
                                </div>
                            </div>

                            {/* Fabrics */}
                            {order.fabrics && order.fabrics.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üì¶ L√°tky</h5>
                                    {order.fabrics.map((f, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{f.name} ({f.quantity} m¬≤)</span>
                                            <span>{formatCurrency(f.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Decorations */}
                            {order.decorations && order.decorations.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">‚ú® Zdoben√≠</h5>
                                    {order.decorations.map((d, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{d.name} ({d.quantity} {d.unit})</span>
                                            <span>{formatCurrency(d.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Time */}
                            <div>
                                <h5 className="font-medium text-sm mb-1">‚è±Ô∏è ƒåas</h5>
                                <div className="flex justify-between text-xs text-gray mb-1">
                                    <span>P≈ô√≠prava ({order.preparationTime}h)</span>
                                    <span>{formatCurrency(order.preparationTime * order.preparationRate)}</span>
                                </div>
                                <div className="flex justify-between text-xs text-gray">
                                    <span>≈†vadlena ({order.seamstressTime}h)</span>
                                    <span>{formatCurrency(order.seamstressTime * order.seamstressRate)}</span>
                                </div>
                            </div>

                            {/* Extras */}
                            {order.extras && order.extras.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üîß V√≠cepr√°ce</h5>
                                    {order.extras.map((e, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{e.name}</span>
                                            <span>{formatCurrency(e.price)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Images */}
                            {order.images && order.images.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üì∑ Fotografie</h5>
                                    <div className="image-grid">
                                        {order.images.map((img, i) => (
                                            <img 
                                                key={i}
                                                src={img}
                                                alt={`Foto ${i + 1}`}
                                                style={{width: '100%', height: '5rem', objectFit: 'cover', borderRadius: '0.5rem', cursor: 'pointer'}}
                                                onClick={() => window.open(img, '_blank')}
                                            />
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Notes */}
                            {order.notes && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">üìù Pozn√°mky</h5>
                                    <p className="text-xs text-gray">{order.notes}</p>
                                </div>
                            )}

                            {/* Actions */}
                            <div className="flex gap-2 border-t pt-3">
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        exportOrder(order);
                                    }}
                                    className="btn btn-secondary flex-1 btn-small"
                                >
                                    üíæ Export
                                </button>
                                {order.status === 'completed' && (
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            reactivateOrder();
                                        }}
                                        className="btn btn-success flex-1 btn-small"
                                    >
                                        ‚Ü©Ô∏è Obnovit
                                    </button>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Settings Component
        const Settings = ({ rates, setRates, fabrics, decorations, orders, logo, setLogo, showToast }) => {
            const [tempRates, setTempRates] = useState(rates);

            const handleSave = () => {
                setRates(tempRates);
                showToast('‚úÖ Nastaven√≠ ulo≈æeno');
            };

            const handleReset = () => {
                if (window.confirm('‚ö†Ô∏è Opravdu vymazat v≈°echna data? Tato akce je nevratn√°!')) {
                    localStorage.clear();
                    window.location.reload();
                }
            };

            const exportData = () => {
                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    fabrics,
                    decorations,
                    orders,
                    rates
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `atelier-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('‚úÖ Data exportov√°na');
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.version && data.fabrics && data.orders && data.rates) {
                            if (window.confirm('Opravdu chcete importovat data? Souƒçasn√° data budou p≈ôeps√°na.')) {
                                window.localStorage.setItem('fabrics', JSON.stringify(data.fabrics));
                                window.localStorage.setItem('decorations', JSON.stringify(data.decorations || []));
                                window.localStorage.setItem('orders', JSON.stringify(data.orders));
                                window.localStorage.setItem('rates', JSON.stringify(data.rates));
                                showToast('‚úÖ Data importov√°na');
                                setTimeout(() => window.location.reload(), 1500);
                            }
                        } else {
                            alert('‚ùå Neplatn√Ω form√°t souboru!');
                        }
                    } catch (error) {
                        alert('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ souboru!');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            return (
                <div className="fade-in space-y-4">
                    <h2 className="text-xl heading-font font-semibold">
                        ‚öôÔ∏è Nastaven√≠
                    </h2>

                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            üé® Logo aplikace
                        </h3>
                        <div className="text-center mb-4">
                            <div style={{fontSize: '4rem', height: '5rem', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
                                {logo.startsWith('data:') ? (
                                    <img src={logo} alt="Logo" style={{maxHeight: '5rem', maxWidth: '100%', objectFit: 'contain'}} />
                                ) : (
                                    <span>{logo}</span>
                                )}
                            </div>
                        </div>
                        <div className="space-y-2">
                            <label className="btn btn-secondary w-full" style={{cursor: 'pointer'}}>
                                üì§ Nahr√°t vlastn√≠ logo
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={(e) => {
                                        const file = e.target.files[0];
                                        if (file) {
                                            if (file.size > 500000) {
                                                alert('‚ö†Ô∏è Obr√°zek je p≈ô√≠li≈° velk√Ω (max 500KB)');
                                                return;
                                            }
                                            const reader = new FileReader();
                                            reader.onloadend = () => {
                                                setLogo(reader.result);
                                                showToast('‚úÖ Logo aktualizov√°no');
                                            };
                                            reader.readAsDataURL(file);
                                        }
                                        e.target.value = '';
                                    }}
                                    style={{display: 'none'}}
                                />
                            </label>
                            <button
                                onClick={() => {
                                    setLogo('‚úÇÔ∏è');
                                    showToast('‚úÖ Logo obnoveno');
                                }}
                                className="btn btn-secondary w-full"
                            >
                                üîÑ Obnovit v√Ωchoz√≠
                            </button>
                        </div>
                    </div>

                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            üí∞ Hodinov√© sazby
                        </h3>
                        <div className="space-y-3 mb-4">
                            <div className="form-group">
                                <label className="form-label">P≈ô√≠prava (Kƒç/hod)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={tempRates.preparation}
                                    onChange={(e) => setTempRates({...tempRates, preparation: parseFloat(e.target.value)})}
                                    className="form-input"
                                />
                            </div>

                            <div className="form-group">
                                <label className="form-label">≈†vadlena (Kƒç/hod)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={tempRates.seamstress}
                                    onChange={(e) => setTempRates({...tempRates, seamstress: parseFloat(e.target.value)})}
                                    className="form-input"
                                />
                            </div>
                        </div>

                        <button
                            onClick={handleSave}
                            className="btn btn-primary w-full"
                        >
                            üíæ Ulo≈æit
                        </button>
                    </div>

                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            üíæ Z√°lohov√°n√≠ dat
                        </h3>
                        <p className="text-xs text-gray mb-3">
                            Exportujte v≈°echna va≈°e data jako z√°lo≈æn√≠ soubor nebo nahrajte existuj√≠c√≠ z√°lohu
                        </p>
                        <div className="space-y-2">
                            <button
                                onClick={exportData}
                                className="btn btn-primary w-full"
                            >
                                üì• St√°hnout z√°lohu (JSON)
                            </button>
                            <div>
                                <label className="btn btn-secondary w-full" style={{cursor: 'pointer'}}>
                                    üì§ Nahr√°t z√°lohu (JSON)
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        style={{display: 'none'}}
                                    />
                                </label>
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            üìä P≈ôehled dat
                        </h3>
                        <div className="grid grid-3 gap-2 mb-4">
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{fabrics.length}</div>
                                <div className="text-xs text-gray">L√°tek</div>
                            </div>
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{decorations?.length || 0}</div>
                                <div className="text-xs text-gray">Zdoben√≠</div>
                            </div>
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{orders.filter(o => o.status === 'active').length}</div>
                                <div className="text-xs text-gray">Aktivn√≠ch</div>
                            </div>
                        </div>
                        <div className="grid grid-2 gap-2 mb-4">
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{orders.filter(o => o.status === 'completed').length}</div>
                                <div className="text-xs text-gray">Dokonƒçen√Ωch</div>
                            </div>
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{orders.length}</div>
                                <div className="text-xs text-gray">Celkem zak√°zek</div>
                            </div>
                        </div>
                        <p className="text-xs text-gray mb-3">
                            Data jsou ulo≈æena lok√°lnƒõ ve va≈°em prohl√≠≈æeƒçi. Pravidelnƒõ z√°lohujte pomoc√≠ karty v√Ω≈°e.
                        </p>
                        <button
                            onClick={handleReset}
                            className="btn btn-danger w-full"
                        >
                            ‚ö†Ô∏è Vymazat v≈°e
                        </button>
                    </div>

                    <div className="card text-center">
                        <h3 className="font-semibold mb-2">
                            ‚ÑπÔ∏è O aplikaci
                        </h3>
                        <p className="text-sm text-gray">
                            <strong>Atelier Manager</strong>
                        </p>
                        <p className="text-xs text-gray mt-1">
                            Verze 1.0 Mobile ‚Ä¢ React PWA
                        </p>
                        <p className="text-xs text-gray mt-2">
                            Pro iPhone optimalizov√°no
                        </p>
                    </div>
                </div>
            );
        };

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AtelierManager />);
    </script>
</body>
</html>