<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VIKA">
    <link rel="apple-touch-icon" href="data:image/png;base64,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">
    <title>Atelier Manager - Správa zakázkového šití</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400;1,500&family=DM+Sans:wght@300;400;500&display=swap');

        :root {
            --bg-base:        #fdf4f9;
            --bg-gradient:    linear-gradient(160deg, #fce8f3 0%, #f0eaff 50%, #e8f0ff 100%);
            --bg-card:        rgba(255,255,255,0.72);
            --bg-card-solid:  #ffffff;
            --border:         rgba(180,130,170,0.18);
            --border-focus:   #b07fac;
            --text-primary:   #2a1f28;
            --text-secondary: #7a5a74;
            --text-muted:     #b09aad;
            --accent:         #9b4d8a;
            --accent-light:   #c47bba;
            --accent-pale:    #f0d6ec;
            --accent-mid:     #b86aad;
            --success:        #7abf8e;
            --danger:         #e07070;
            --amber:          #c48a50;
            --radius-xl:      1.5rem;
            --radius-lg:      1.25rem;
            --radius-md:      0.875rem;
            --radius-sm:      0.625rem;
            --shadow-card:    0 4px 24px rgba(140,80,130,0.1), 0 1px 4px rgba(140,80,130,0.06);
            --shadow-btn:     0 4px 16px rgba(155,77,138,0.3);
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            line-height: 1.6;
            font-size: 15px;
        }

        /* Soft ambient blobs */
        body::before {
            content: '';
            position: fixed; inset: 0; pointer-events: none; z-index: 0;
            background:
                radial-gradient(ellipse 70% 50% at 15% 0%, rgba(220,160,210,0.28) 0%, transparent 55%),
                radial-gradient(ellipse 55% 45% at 85% 100%, rgba(180,160,240,0.22) 0%, transparent 55%),
                radial-gradient(ellipse 40% 35% at 50% 50%, rgba(255,210,240,0.15) 0%, transparent 60%);
        }
        #root { position: relative; z-index: 1; }

        .heading-font { font-family: 'Playfair Display', serif; }

        /* Layout */
        .container { max-width: 1280px; margin: 0 auto; padding: 0 1rem; }

        /* Header */
        .header {
            background: rgba(253,244,249,0.88);
            backdrop-filter: blur(24px) saturate(180%);
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 50; padding: 1rem 0;
        }
        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem; font-weight: 500;
            color: var(--text-primary); letter-spacing: 0.01em;
        }
        .header p { color: var(--text-secondary); margin-top: 0.2rem; font-size: 0.8125rem; }

        /* Nav */
        .nav {
            background: rgba(253,244,249,0.88);
            backdrop-filter: blur(24px);
            border-bottom: 1px solid var(--border);
            position: sticky; top: 64px; z-index: 40;
            overflow-x: auto; -webkit-overflow-scrolling: touch;
        }
        .nav::-webkit-scrollbar { display: none; }
        .nav-list { display: flex; gap: 0; list-style: none; min-width: min-content; }

        .nav-button {
            background: none; border: none;
            border-bottom: 2px solid transparent;
            padding: 0.875rem 1.125rem;
            cursor: pointer; font-size: 0.8125rem; font-weight: 500;
            color: var(--text-muted); white-space: nowrap;
            transition: all 0.25s; touch-action: manipulation;
            font-family: 'DM Sans', sans-serif;
        }
        .nav-button:active { transform: scale(0.95); }
        .nav-button.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        /* Main */
        .main { padding: 1.25rem 0 5rem 0; min-height: calc(100vh - 140px); }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 1.375rem; margin-bottom: 1rem;
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(16px);
            transition: all 0.3s;
        }
        .card:active { transform: scale(0.985); }
        @media (min-width: 768px) {
            .card { padding: 1.75rem; }
            .header h1 { font-size: 2rem; }
            .header { padding: 1.5rem 0; }
            .nav { top: 88px; }
        }

        /* Grid */
        .grid { display: grid; gap: 1rem; }
        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(2, 1fr); }
        @media (min-width: 768px) {
            .grid-3 { grid-template-columns: repeat(3, 1fr); }
            .grid-4 { grid-template-columns: repeat(4, 1fr); }
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.5rem; border: none;
            border-radius: 999px; /* pill shape like Equilibrium */
            font-size: 0.9375rem; font-weight: 500;
            cursor: pointer; transition: all 0.2s;
            display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
            touch-action: manipulation; min-height: 44px;
            font-family: 'DM Sans', sans-serif; letter-spacing: 0.01em;
        }
        .btn:active { transform: scale(0.95); }

        .btn-primary {
            background: var(--accent);
            color: #fff;
            box-shadow: var(--shadow-btn);
        }
        .btn-primary:hover { background: #87417a; box-shadow: 0 6px 24px rgba(155,77,138,0.4); }

        .btn-secondary {
            background: rgba(155,77,138,0.08);
            color: var(--accent);
            border: 1px solid rgba(155,77,138,0.2);
        }
        .btn-secondary:hover { background: rgba(155,77,138,0.14); }

        .btn-danger {
            background: rgba(224,112,112,0.1);
            color: var(--danger);
            border: 1px solid rgba(224,112,112,0.25);
        }

        .btn-success {
            background: rgba(122,191,142,0.12);
            color: #4a9b62;
            border: 1px solid rgba(122,191,142,0.3);
        }

        .btn-small {
            padding: 0.5rem 0.875rem;
            font-size: 1.125rem;
            min-height: 44px; min-width: 44px;
        }

        .btn-export {
            background: var(--accent);
            color: white;
            box-shadow: var(--shadow-btn);
            font-size: 1.5rem;
        }

        /* Forms */
        .form-group { margin-bottom: 1rem; }

        .form-label {
            display: block; font-size: 0.75rem; font-weight: 500;
            color: var(--text-secondary); margin-bottom: 0.5rem;
            letter-spacing: 0.05em; text-transform: uppercase;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%; padding: 0.875rem 1rem;
            background: rgba(255,255,255,0.8);
            border: 1.5px solid rgba(180,130,170,0.25);
            border-radius: var(--radius-md);
            font-size: 0.9375rem; font-family: 'DM Sans', sans-serif;
            color: var(--text-primary); transition: all 0.2s; min-height: 44px;
        }
        .form-input::placeholder, .form-textarea::placeholder { color: var(--text-muted); }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-light);
            box-shadow: 0 0 0 3px rgba(155,77,138,0.12);
            background: #fff;
        }
        .form-textarea { resize: vertical; min-height: 100px; }

        /* Stat Cards - Equilibrium bubble/card style */
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 1.125rem; border-radius: var(--radius-xl);
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(16px);
            transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .stat-card::after {
            content: '';
            position: absolute; bottom: -20px; right: -20px;
            width: 70px; height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(155,77,138,0.12) 0%, transparent 70%);
        }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 8px 32px rgba(140,80,130,0.15); }

        .stat-icon { font-size: 1.75rem; margin-bottom: 0.625rem; }
        .stat-label {
            color: var(--text-secondary); font-size: 0.6875rem;
            font-weight: 500; text-transform: uppercase; letter-spacing: 0.07em;
        }
        .stat-value {
            font-size: 1.125rem; font-weight: 600; color: var(--text-primary); margin-top: 0.375rem;
            font-family: 'Playfair Display', serif;
        }

        @media (min-width: 768px) {
            .stat-card { padding: 1.5rem; }
            .stat-icon { font-size: 2rem; }
            .stat-label { font-size: 0.75rem; }
            .stat-value { font-size: 1.5rem; }
        }

        /* List Items */
        .list-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 1rem 1.125rem; border-radius: var(--radius-lg);
            margin-bottom: 0.625rem;
            box-shadow: 0 2px 10px rgba(140,80,130,0.07);
            transition: all 0.2s; touch-action: manipulation;
        }
        .list-item:active, .list-item:hover { background: rgba(255,255,255,0.9); border-color: rgba(155,77,138,0.25); }

        /* Fabric Card */
        .fabric-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl); overflow: hidden;
            box-shadow: var(--shadow-card);
            transition: all 0.3s;
        }
        .fabric-card:hover { transform: translateY(-3px); box-shadow: 0 8px 32px rgba(140,80,130,0.15); }

        .fabric-image { width: 100%; height: 10rem; background: var(--accent-pale); overflow: hidden; }
        .fabric-image img { width: 100%; height: 100%; object-fit: cover; }
        .fabric-content { padding: 1rem; }
        .fabric-name { font-size: 0.9375rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.625rem; font-family: 'Playfair Display', serif; }
        .fabric-info { display: flex; justify-content: space-between; margin-bottom: 0.375rem; font-size: 0.8125rem; color: var(--text-secondary); }
        .fabric-actions { display: flex; gap: 0.5rem; margin-top: 0.875rem; }

        /* Order Card */
        .order-card {
            border: 1.5px solid rgba(180,130,170,0.22);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1rem; margin-bottom: 0.75rem;
            box-shadow: 0 2px 10px rgba(140,80,130,0.07);
            transition: all 0.2s; touch-action: manipulation;
        }
        .order-card:active, .order-card:hover { border-color: var(--accent-light); background: rgba(255,255,255,0.9); }

        .order-header { display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .order-details { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border); }

        /* Image Grid */
        .image-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 1rem; }
        .image-preview { position: relative; width: 100%; height: 5rem; border-radius: var(--radius-sm); overflow: hidden; border: 1.5px solid var(--border); }
        .image-preview img { width: 100%; height: 100%; object-fit: cover; }
        .image-remove {
            position: absolute; top: 0.25rem; right: 0.25rem;
            background: var(--danger); color: white; border: none;
            border-radius: 50%; width: 1.75rem; height: 1.75rem;
            cursor: pointer; font-size: 0.75rem;
            display: flex; align-items: center; justify-content: center;
            touch-action: manipulation;
        }

        /* Empty State */
        .empty-state { text-align: center; padding: 3rem 1rem; color: var(--text-muted); }
        .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }

        /* Summary */
        .summary-section {
            background: linear-gradient(135deg, rgba(155,77,138,0.06) 0%, rgba(180,160,240,0.08) 100%);
            border: 1px solid rgba(155,77,138,0.15);
            padding: 1rem; border-radius: var(--radius-md); margin-top: 1rem;
        }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 0.625rem; font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; }
        .summary-total {
            display: flex; justify-content: space-between;
            padding-top: 0.75rem; border-top: 1.5px solid rgba(155,77,138,0.2);
            font-size: 1.125rem; font-weight: 600; margin-top: 0.75rem;
            color: var(--accent); font-family: 'Playfair Display', serif;
        }

        /* Modal */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(42,31,40,0.45);
            backdrop-filter: blur(12px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; padding: 1rem;
        }
        .modal {
            background: #fff;
            border: 1px solid rgba(155,77,138,0.2);
            border-radius: var(--radius-xl);
            padding: 1.75rem; max-width: 500px; width: 100%;
            max-height: 80vh; overflow-y: auto;
            box-shadow: 0 30px 80px rgba(42,31,40,0.22), 0 0 0 1px rgba(155,77,138,0.08);
        }
        .modal-title {
            font-size: 1.375rem; font-weight: 500; margin-bottom: 1rem;
            color: var(--text-primary); font-family: 'Playfair Display', serif;
        }
        .modal-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; }

        /* Utilities */
        .mb-1{margin-bottom:.25rem} .mb-2{margin-bottom:.5rem} .mb-3{margin-bottom:.75rem}
        .mb-4{margin-bottom:1rem} .mb-6{margin-bottom:1.5rem} .mb-8{margin-bottom:2rem}
        .mb-0\.5{margin-bottom:.125rem}
        .mt-1{margin-top:.25rem} .mt-2{margin-top:.5rem} .mt-4{margin-top:1rem} .mt-6{margin-top:1.5rem}
        .mt-0\.5{margin-top:.125rem}
        .space-y-2>*+*{margin-top:.625rem} .space-y-3>*+*{margin-top:.875rem}
        .space-y-4>*+*{margin-top:1rem} .space-y-6>*+*{margin-top:1.5rem} .space-y-8>*+*{margin-top:2rem}
        .flex{display:flex} .flex-col{flex-direction:column} .items-center{align-items:center}
        .justify-between{justify-content:space-between} .justify-end{justify-content:flex-end}
        .gap-2{gap:.5rem} .gap-3{gap:.75rem} .gap-4{gap:1rem}
        .text-center{text-align:center} .text-right{text-align:right}
        .text-sm{font-size:.875rem} .text-xs{font-size:.75rem} .text-lg{font-size:1.125rem}
        .text-xl{font-size:1.25rem} .text-2xl{font-size:1.5rem} .text-3xl{font-size:1.875rem} .text-4xl{font-size:2.25rem}
        .font-medium{font-weight:500} .font-semibold{font-weight:600} .font-bold{font-weight:700}
        .text-gray{color:var(--text-secondary)} .text-green{color:#4a9b62} .text-green-600{color:#4a9b62} .text-red{color:var(--danger)}
        .border-t{border-top:1px solid var(--border)} .border-b{border-bottom:1px solid var(--border)}
        .pt-4{padding-top:1rem} .pt-6{padding-top:1.5rem} .pb-4{padding-bottom:1rem}
        .flex-1{flex:1} .w-full{width:100%} .hidden{display:none}
        .min-w-0{min-width:0} .truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

        /* Section headings */
        h2, h3 { font-family: 'Playfair Display', serif; font-weight: 500; color: var(--text-primary); }
        h4 { color: var(--text-primary); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(155,77,138,0.25); border-radius: 2px; }

        /* Sub-tabs (pill style) */
        .sub-tabs { display: flex; gap: 0.5rem; margin-bottom: 1.25rem; flex-wrap: wrap; }
        .sub-tab {
            padding: 0.5rem 1.125rem; border-radius: 999px; font-size: 0.8125rem; font-weight: 500;
            cursor: pointer; border: 1.5px solid rgba(155,77,138,0.2);
            background: rgba(255,255,255,0.6); color: var(--text-secondary);
            transition: all 0.2s; font-family: 'DM Sans', sans-serif;
        }
        .sub-tab.active {
            background: var(--accent); border-color: var(--accent);
            color: #fff; box-shadow: 0 4px 14px rgba(155,77,138,0.3);
        }

        /* Fade animation */
        .fade-in { animation: fadeIn 0.35s ease-out; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

        /* Toast */
        .toast {
            position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%);
            background: var(--accent); color: white;
            padding: 0.875rem 1.75rem; border-radius: 999px;
            box-shadow: 0 8px 32px rgba(155,77,138,0.4);
            z-index: 2000; animation: slideUp 0.3s ease-out;
            font-weight: 500; white-space: nowrap;
        }
        @keyframes slideUp {
            from{opacity:0;transform:translateX(-50%) translateY(20px)}
            to{opacity:1;transform:translateX(-50%) translateY(0)}
        }
        @keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }

        @supports (padding: env(safe-area-inset-bottom)) {
            .main { padding-bottom: calc(5rem + env(safe-area-inset-bottom)); }
        }

        /* SVG Icon styles */
        .icon {
            display: inline-flex; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        .icon svg { display: block; }

        /* Stat card icon container */
        .stat-icon-wrap {
            width: 2.5rem; height: 2.5rem;
            border-radius: 0.75rem;
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 0.75rem;
        }

        /* Nav icon+label layout */
        .nav-button { display: flex; flex-direction: column; align-items: center; gap: 0.2rem; padding: 0.625rem 1rem; }
        .nav-label { font-size: 0.6875rem; }

        /* Section icon */
        .section-icon {
            width: 1.75rem; height: 1.75rem;
            border-radius: 0.5rem;
            display: inline-flex; align-items: center; justify-content: center;
            background: rgba(155,77,138,0.1);
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ── SVG Icon Library ──────────────────────────────────────────
        const Icon = ({ name, size = 20, color = 'currentColor', strokeWidth = 1.6 }) => {
            const paths = {
                dashboard: <><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></>,
                inventory: <><path d="M20 7H4a1 1 0 00-1 1v11a1 1 0 001 1h16a1 1 0 001-1V8a1 1 0 00-1-1z"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/><line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/></>,
                orders: <><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></>,
                history: <><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>,
                settings: <><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></>,
                scissors: <><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></>,
                chart: <><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></>,
                trending: <><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></>,
                zap: <><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></>,
                star: <><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></>,
                alert: <><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>,
                user: <><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
                users: <><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></>,
                check: <><polyline points="20 6 9 17 4 12"/></>,
                checkCircle: <><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>,
                plus: <><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>,
                edit: <><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></>,
                trash: <><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"/></>,
                download: <><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>,
                upload: <><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></>,
                cloud: <><path d="M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"/></>,
                lock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></>,
                image: <><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></>,
                tag: <><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></>,
                package: <><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></>,
                needle: <><path d="M3 21l4-4"/><path d="M14 3c1.5 0 4 .5 5.5 2S21 9 21 10.5c0 3-3 5-7 7L3 21l3.5-11C7.5 6.5 9 6 10.5 6"/><path d="M10.5 6C12 4 14 3 14 3"/></>,
                sparkle: <><path d="M12 3l1.5 4.5L18 9l-4.5 1.5L12 15l-1.5-4.5L6 9l4.5-1.5L12 3z"/><path d="M5 17l.75 2.25L8 20l-2.25.75L5 23l-.75-2.25L2 20l2.25-.75L5 17z"/><path d="M19 2l.5 1.5L21 4l-1.5.5L19 6l-.5-1.5L17 4l1.5-.5L19 2z"/></>,
                scissors2: <><path d="M9 3l-3.5 9"/><path d="M15 3l3.5 9"/><path d="M5.5 12a2.5 2.5 0 100 5 2.5 2.5 0 000-5z"/><path d="M18.5 12a2.5 2.5 0 100 5 2.5 2.5 0 000-5z"/><path d="M8 14h8"/></>,
                close: <><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>,
                chevronDown: <><polyline points="6 9 12 15 18 9"/></>,
                chevronRight: <><polyline points="9 18 15 12 9 6"/></>,
                rotate: <><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></>,
                wifi: <><path d="M5 12.55a11 11 0 0114.08 0"/><path d="M1.42 9a16 16 0 0121.16 0"/><path d="M8.53 16.11a6 6 0 016.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></>,
                money: <><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></>,
                box: <><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/></>,
                camera: <><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></>,
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round">
                    {paths[name] || paths['sparkle']}
                </svg>
            );
        };
        
        // Utility functions
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('cs-CZ', { style: 'currency', currency: 'CZK' }).format(amount);
        };
        
        const formatDate = (date) => {
            return new Date(date).toLocaleDateString('cs-CZ');
        };

        // Toast notification component
        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="toast">
                    {message}
                </div>
            );
        };

        // LocalStorage hooks
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error(error);
                    return initialValue;
                }
            });

            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) {
                    console.error(error);
                }
            };

            return [storedValue, setValue];
        };

        // Helper functions
        const calculateOrderTotal = (order) => {
            // Return sale price if available, otherwise calculate from old margin system for backwards compatibility
            if (order.salePrice) {
                return order.salePrice;
            }
            // Fallback for old orders with margin
            const fabricsCost = order.fabrics?.reduce((sum, f) => sum + f.totalCost, 0) || 0;
            const decorationsCost = order.decorations?.reduce((sum, d) => sum + d.totalCost, 0) || 0;
            const prepCost = (order.preparationTime || 0) * (order.preparationRate || 0);
            const seamCost = order.seamstressPrice || ((order.seamstressTime || 0) * (order.seamstressRate || 0));
            const extraCost = order.extras?.reduce((sum, e) => sum + e.price, 0) || 0;
            const subtotal = fabricsCost + decorationsCost + prepCost + seamCost + extraCost;
            const margin = order.margin || 0;
            return subtotal * (1 + margin / 100);
        };

        const calculateOrderCosts = (order) => {
            const fabricsCost = order.fabrics?.reduce((sum, f) => sum + f.totalCost, 0) || 0;
            const decorationsCost = order.decorations?.reduce((sum, d) => sum + d.totalCost, 0) || 0;
            const basicsCost = order.basics?.reduce((sum, b) => sum + b.totalCost, 0) || 0;
            const prepCost = (order.preparationTime || 0) * (order.preparationRate || 0);
            // Use seamstressPrice if available, otherwise calculate from time * rate (backwards compatibility)
            const seamCost = order.seamstressPrice || ((order.seamstressTime || 0) * (order.seamstressRate || 0));
            const extrasCost = order.extras?.reduce((sum, e) => sum + e.price, 0) || 0;
            return fabricsCost + decorationsCost + basicsCost + prepCost + seamCost + extrasCost;
        };

        // Export/Import Modal Component
        const ExportImportModal = ({ onClose, fabrics, setFabrics, decorations, setDecorations, basics, setBasics, orders, setOrders, rates, setRates }) => {
            const exportData = () => {
                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    fabrics,
                    decorations,
                    orders,
                    rates
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `atelier-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.version && data.fabrics && data.orders && data.rates) {
                            if (window.confirm('Opravdu chcete importovat data? Současná data budou přepsána.')) {
                                setFabrics(data.fabrics);
                                setDecorations(data.decorations || []);
                                setBasics(data.basics || []);
                                setOrders(data.orders);
                                setRates(data.rates);
                                alert('✅ Data byla úspěšně importována!');
                                onClose();
                            }
                        } else {
                            alert('❌ Neplatný formát souboru!');
                        }
                    } catch (error) {
                        alert('❌ Chyba při načítání souboru!');
                    }
                };
                reader.readAsText(file);
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <h3 className="modal-title" style={{display:"flex",alignItems:"center",gap:"0.5rem"}}><Icon name="download" size={18} color="var(--accent)"/> Export / Import dat</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <h4 className="font-semibold mb-2">Export dat</h4>
                                <p className="text-sm text-gray mb-3">
                                    Stáhněte všechna vaše data jako záložní soubor JSON
                                </p>
                                <button
                                    onClick={exportData}
                                    className="btn btn-primary w-full"
                                >
                                    Stáhnout zálohu
                                </button>
                            </div>

                            <div className="border-t pt-4">
                                <h4 className="font-semibold mb-2">Import dat</h4>
                                <p className="text-sm text-gray mb-3">
                                    Nahrajte záložní soubor JSON
                                </p>
                                <input
                                    type="file"
                                    accept=".json"
                                    onChange={importData}
                                    className="form-input"
                                />
                            </div>
                        </div>

                        <div className="modal-actions">
                            <button
                                onClick={onClose}
                                className="btn btn-secondary flex-1"
                            >
                                Zavřít
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const AtelierManager = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [fabrics, setFabrics] = useLocalStorage('fabrics', []);
            const [decorations, setDecorations] = useLocalStorage('decorations', []);
            const [basics, setBasics] = useLocalStorage('basics', []);
            const [orders, setOrders] = useLocalStorage('orders', []);
            const [rates, setRates] = useLocalStorage('rates', {
                preparation: 500,
                seamstress: 400
            });
            const [logo, setLogo] = useLocalStorage('appLogo', '✂️');
            const [sheetsUrl, setSheetsUrl] = useLocalStorage('googleSheetsUrl', '');
            const [syncEnabled, setSyncEnabled] = useLocalStorage('syncEnabled', false);
            const [lastSync, setLastSync] = useLocalStorage('lastSync', null);
            const [syncStatus, setSyncStatus] = useState('idle');
            const [showExportModal, setShowExportModal] = useState(false);
            const [showBackupReminder, setShowBackupReminder] = useState(false);
            const [toast, setToast] = useState(null);

            // Check if backup reminder should be shown (every 7 days, only if user has data)
            React.useEffect(() => {
                if (orders.length === 0 && fabrics.length === 0) return;
                
                const lastBackupReminder = localStorage.getItem('last-backup-reminder');
                const now = new Date().getTime();
                const sevenDays = 7 * 24 * 60 * 60 * 1000;

                if (!lastBackupReminder || (now - parseInt(lastBackupReminder)) > sevenDays) {
                    // Show reminder after 3 seconds (so user sees the app first)
                    setTimeout(() => {
                        setShowBackupReminder(true);
                    }, 3000);
                }
            }, []);

            const handleDownloadBackup = () => {
                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    fabrics,
                    decorations,
                    basics,
                    orders,
                    rates
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `atelier-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                // Update last backup reminder timestamp
                localStorage.setItem('last-backup-reminder', new Date().getTime().toString());
                setShowBackupReminder(false);
                showToast('✅ Záloha stažena');
            };

            const handleDismissReminder = () => {
                // Update timestamp so it shows again in 7 days
                localStorage.setItem('last-backup-reminder', new Date().getTime().toString());
                setShowBackupReminder(false);
            };

            // Periodic auto-backup to localStorage (every 5 minutes)
            React.useEffect(() => {
                const autoBackup = () => {
                    const data = {
                        version: '1.0',
                        exportDate: new Date().toISOString(),
                        fabrics,
                        decorations,
                        basics,
                        orders,
                        rates
                    };
                    localStorage.setItem('atelier-auto-backup', JSON.stringify(data));
                    console.log('Auto-backup saved to localStorage at', new Date().toLocaleTimeString());
                };

                // Initial backup
                autoBackup();

                // Backup every 5 minutes
                const intervalId = setInterval(autoBackup, 5 * 60 * 1000);
                
                return () => {
                    clearInterval(intervalId);
                };
            }, [fabrics, decorations, basics, orders, rates]);

            // Google Sheets synchronization functions
            const syncToGoogleSheets = async () => {
                if (!syncEnabled || !sheetsUrl) return;
                
                setSyncStatus('syncing');
                
                try {
                    const data = {
                        orders,
                        fabrics,
                        decorations,
                        basics,
                        rates
                    };
                    
                    await fetch(sheetsUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                        mode: 'no-cors'
                    });
                    
                    // no-cors vždy vrátí opaque response - nemůžeme ověřit úspěch,
                    // ale pokud fetch nespadl s network error, request byl odeslán
                    setLastSync(new Date().toISOString());
                    setSyncStatus('success');
                    setTimeout(() => setSyncStatus('idle'), 3000);
                } catch (error) {
                    // Pouze network error (offline, DNS fail atd.) se dostane sem
                    console.error('Sync error:', error);
                    setSyncStatus('error');
                    setTimeout(() => setSyncStatus('idle'), 5000);
                }
            };

            const loadFromGoogleSheets = async () => {
                if (!sheetsUrl) {
                    showToast('⚠️ Nejdřív zadejte URL Google Sheets');
                    return;
                }
                
                setSyncStatus('syncing');
                
                try {
                    const response = await fetch(sheetsUrl);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        if (result.data.orders) setOrders(result.data.orders);
                        if (result.data.fabrics) setFabrics(result.data.fabrics);
                        if (result.data.decorations) setDecorations(result.data.decorations);
                        if (result.data.basics) setBasics(result.data.basics);
                        if (result.data.settings && result.data.settings.rates) {
                            setRates(result.data.settings.rates);
                        }
                        setSyncStatus('success');
                        showToast('✅ Data načtena z Google Sheets');
                        setTimeout(() => setSyncStatus('idle'), 3000);
                    } else {
                        setSyncStatus('error');
                        showToast('⚠️ Chyba: neplatný formát dat');
                        setTimeout(() => setSyncStatus('idle'), 5000);
                    }
                } catch (error) {
                    console.error('Load error:', error);
                    setSyncStatus('error');
                    showToast('⚠️ Chyba načítání z Google Sheets');
                    setTimeout(() => setSyncStatus('idle'), 5000);
                }
            };

            const testGoogleSheetsConnection = async () => {
                if (!sheetsUrl) {
                    showToast('⚠️ Nejdřív zadejte URL');
                    return;
                }
                
                setSyncStatus('syncing');
                
                try {
                    const response = await fetch(sheetsUrl);
                    const result = await response.json();
                    
                    if (result.success !== undefined) {
                        setSyncStatus('success');
                        showToast('✅ Připojení funguje!');
                        setTimeout(() => setSyncStatus('idle'), 3000);
                    } else {
                        setSyncStatus('error');
                        showToast('⚠️ Neplatná odpověď ze serveru');
                        setTimeout(() => setSyncStatus('idle'), 5000);
                    }
                } catch (error) {
                    setSyncStatus('error');
                    showToast('⚠️ Nelze se připojit - zkontrolujte URL');
                    setTimeout(() => setSyncStatus('idle'), 5000);
                }
            };

            // Auto-sync při změně dat
            React.useEffect(() => {
                if (syncEnabled && sheetsUrl) {
                    const timeoutId = setTimeout(() => {
                        syncToGoogleSheets();
                    }, 2000); // Debounce 2 sekundy
                    
                    return () => clearTimeout(timeoutId);
                }
            }, [orders, fabrics, decorations, basics, rates]);


            const showToast = (message) => {
                setToast(message);
            };

            const tabs = [
                { id: 'dashboard', label: 'Přehled', icon: 'dashboard' },
                { id: 'inventory', label: 'Sklad', icon: 'package' },
                { id: 'orders', label: 'Zakázky', icon: 'orders' },
                { id: 'history', label: 'Historie', icon: 'history' },
                { id: 'settings', label: 'Nastavení', icon: 'settings' }
            ];

            return (
                <div>
                    {/* Header */}
                    <header className="header">
                        <div className="container">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="heading-font" style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        {logo.startsWith('data:') ? (
                                            <img src={logo} alt="Logo" style={{height: '2rem', width: 'auto', objectFit: 'contain'}} />
                                        ) : (
                                            <span style={{display:'inline-flex',alignItems:'center',justifyContent:'center',width:'2rem',height:'2rem',borderRadius:'0.625rem',background:'rgba(155,77,138,0.12)'}}>
                                                <Icon name="scissors" size={18} color="var(--accent)" />
                                            </span>
                                        )}
                                        <span>Atelier</span>
                                    </h1>
                                    <p>Správa šití</p>
                                </div>
                                {syncEnabled && (
                                    <div className="text-xs" style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        {syncStatus === 'syncing' && (
                                            <span style={{color: '#c48a50', display: 'flex', alignItems: 'center', gap: '0.25rem'}}>
                                                <span style={{animation: 'spin 1s linear infinite', display:'inline-flex'}}><Icon name="rotate" size={14} color="#c48a50"/></span>
                                                <span>Sync...</span>
                                            </span>
                                        )}
                                        {syncStatus === 'success' && (
                                            <span style={{color: '#4a9b62', display:'flex', alignItems:'center', gap:'0.25rem'}}><Icon name="cloud" size={14} color="#4a9b62"/> Sync</span>
                                        )}
                                        {syncStatus === 'error' && (
                                            <span style={{color: 'var(--danger)', display:'flex', alignItems:'center', gap:'0.25rem'}}><Icon name="alert" size={14} color="var(--danger)"/> Offline</span>
                                        )}
                                        {syncStatus === 'idle' && lastSync && (
                                            <span style={{color: 'var(--text-muted)', display:'inline-flex'}}><Icon name="cloud" size={14} color="var(--text-muted)"/></span>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="nav">
                        <div className="container">
                            <ul className="nav-list">
                                {tabs.map(tab => (
                                    <li key={tab.id}>
                                        <button
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`nav-button ${activeTab === tab.id ? 'active' : ''}`}
                                        >
                                            <Icon name={tab.icon} size={18} />
                                            <span className="nav-label">{tab.label}</span>
                                        </button>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="main">
                        <div className="container">
                            {activeTab === 'dashboard' && (
                                <Dashboard orders={orders} fabrics={fabrics} decorations={decorations} basics={basics} />
                            )}
                            {activeTab === 'inventory' && (
                                <Inventory fabrics={fabrics} setFabrics={setFabrics} decorations={decorations} setDecorations={setDecorations} basics={basics} setBasics={setBasics} orders={orders} showToast={showToast} />
                            )}
                            {activeTab === 'orders' && (
                                <Orders 
                                    orders={orders} 
                                    setOrders={setOrders} 
                                    fabrics={fabrics}
                                    decorations={decorations}
                                    basics={basics}
                                    rates={rates}
                                    showToast={showToast}
                                />
                            )}
                            {activeTab === 'history' && (
                                <History orders={orders} setOrders={setOrders} showToast={showToast} />
                            )}
                            {activeTab === 'settings' && (
                                <Settings 
                                    rates={rates} 
                                    setRates={setRates}
                                    fabrics={fabrics}
                                    decorations={decorations}
                                    orders={orders}
                                    logo={logo}
                                    setLogo={setLogo}
                                    sheetsUrl={sheetsUrl}
                                    setSheetsUrl={setSheetsUrl}
                                    syncEnabled={syncEnabled}
                                    setSyncEnabled={setSyncEnabled}
                                    lastSync={lastSync}
                                    syncStatus={syncStatus}
                                    syncToGoogleSheets={syncToGoogleSheets}
                                    loadFromGoogleSheets={loadFromGoogleSheets}
                                    testGoogleSheetsConnection={testGoogleSheetsConnection}
                                    showToast={showToast}
                                />
                            )}
                        </div>
                    </main>

                    {/* Export/Import Modal */}
                    {showExportModal && (
                        <ExportImportModal
                            onClose={() => setShowExportModal(false)}
                            fabrics={fabrics}
                            setFabrics={setFabrics}
                            decorations={decorations}
                            setDecorations={setDecorations}
                            basics={basics}
                            setBasics={setBasics}
                            orders={orders}
                            setOrders={setOrders}
                            rates={rates}
                            setRates={setRates}
                        />
                    )}

                    {/* Backup Reminder Modal */}
                    {showBackupReminder && (
                        <div className="modal-overlay" onClick={handleDismissReminder}>
                            <div className="modal" onClick={(e) => e.stopPropagation()} style={{maxWidth: '400px'}}>
                                <div className="text-center mb-4">
                                    <div style={{width:'4rem',height:'4rem',borderRadius:'1.25rem',background:'rgba(155,77,138,0.1)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 1rem'}}><Icon name="download" size={28} color="var(--accent)"/></div>
                                    <h3 className="font-semibold text-lg mb-2">
                                        Nezapomeňte stáhnout zálohu
                                    </h3>
                                    <p className="text-sm text-gray">
                                        Pravidelné zálohování chrání vaše data. Doporučujeme stahovat zálohu alespoň jednou za týden.
                                    </p>
                                    {(() => {
                                        const lastBackup = localStorage.getItem('last-backup-reminder');
                                        if (lastBackup) {
                                            const days = Math.floor((new Date().getTime() - parseInt(lastBackup)) / (24 * 60 * 60 * 1000));
                                            return (
                                                <p className="text-xs text-gray mt-2">
                                                    Poslední připomínka: před {days} {days === 1 ? 'dnem' : days < 5 ? 'dny' : 'dny'}
                                                </p>
                                            );
                                        }
                                        return null;
                                    })()}
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={handleDismissReminder}
                                        className="btn btn-secondary flex-1"
                                    >
                                        Později
                                    </button>
                                    <button
                                        onClick={handleDownloadBackup}
                                        className="btn btn-primary flex-1"
                                    >
                                        Stáhnout teď
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Toast Notification */}
                    {toast && (
                        <Toast message={toast} onClose={() => setToast(null)} />
                    )}
                </div>
            );
        };

        // ── LineChart Component ───────────────────────────────────────
        const LineChart = ({ data }) => {
            const [tooltip, setTooltip] = useState(null); // { x, y, idx }
            const [hovered, setHovered] = useState(null);

            const W = 600, H = 220;
            const padL = 58, padR = 16, padT = 20, padB = 36;
            const innerW = W - padL - padR;
            const innerH = H - padT - padB;
            const n = data.length;

            const allVals = data.flatMap(d => [d.revenue, d.costs]);
            const maxVal = Math.max(...allVals, 1);
            // nice round ceiling
            const niceMax = Math.ceil(maxVal / 1000) * 1000 || 1000;

            const xPos = i => padL + (i / (n - 1)) * innerW;
            const yPos = v => padT + innerH - (v / niceMax) * innerH;

            // Build SVG path string from points
            const makePath = key => {
                return data.map((d, i) => {
                    const x = xPos(i), y = yPos(d[key]);
                    return (i === 0 ? `M ${x},${y}` : `L ${x},${y}`);
                }).join(' ');
            };

            // Smooth cubic bezier path
            const makeSmoothPath = key => {
                const pts = data.map((d, i) => [xPos(i), yPos(d[key])]);
                if (pts.length < 2) return '';
                let d = `M ${pts[0][0]},${pts[0][1]}`;
                for (let i = 1; i < pts.length; i++) {
                    const [px, py] = pts[i - 1];
                    const [cx, cy] = pts[i];
                    const cp1x = px + (cx - px) * 0.45;
                    const cp2x = cx - (cx - px) * 0.45;
                    d += ` C ${cp1x},${py} ${cp2x},${cy} ${cx},${cy}`;
                }
                return d;
            };

            // Area fill path (close to bottom)
            const makeAreaPath = key => {
                const pts = data.map((d, i) => [xPos(i), yPos(d[key])]);
                if (pts.length < 2) return '';
                let d = `M ${pts[0][0]},${padT + innerH}`;
                d += ` L ${pts[0][0]},${pts[0][1]}`;
                for (let i = 1; i < pts.length; i++) {
                    const [px, py] = pts[i - 1];
                    const [cx, cy] = pts[i];
                    const cp1x = px + (cx - px) * 0.45;
                    const cp2x = cx - (cx - px) * 0.45;
                    d += ` C ${cp1x},${py} ${cp2x},${cy} ${cx},${cy}`;
                }
                d += ` L ${pts[pts.length - 1][0]},${padT + innerH} Z`;
                return d;
            };

            // Y-axis grid lines (4 steps)
            const gridLines = [0, 0.25, 0.5, 0.75, 1].map(t => ({
                y: padT + innerH - t * innerH,
                label: t === 0 ? '0' : (niceMax * t >= 1000
                    ? `${(niceMax * t / 1000).toFixed(niceMax * t % 1000 === 0 ? 0 : 1)}k`
                    : `${niceMax * t}`)
            }));

            const hasData = maxVal > 0;

            return (
                <div className="card" style={{padding: '1.25rem'}}>
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="font-semibold flex items-center gap-2">
                            <span className="section-icon"><Icon name="trending" size={14} color="var(--accent)" /></span>
                            <span>Příjmy a Náklady — posledních 12 měsíců</span>
                        </h3>
                        <div className="flex gap-3" style={{fontSize: '0.6875rem', fontWeight: 500}}>
                            <span style={{display:'flex',alignItems:'center',gap:'0.3rem'}}>
                                <span style={{width:20,height:3,borderRadius:2,background:'#9b4d8a',display:'inline-block'}}/>
                                Příjmy
                            </span>
                            <span style={{display:'flex',alignItems:'center',gap:'0.3rem'}}>
                                <span style={{width:20,height:3,borderRadius:2,background:'#e07070',display:'inline-block'}}/>
                                Náklady
                            </span>
                        </div>
                    </div>

                    {!hasData ? (
                        <div className="empty-state" style={{padding:'2rem 0'}}>
                            <div style={{width:'3rem',height:'3rem',borderRadius:'0.875rem',background:'rgba(155,77,138,0.08)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 0.75rem'}}>
                                <Icon name="trending" size={22} color="var(--text-muted)" />
                            </div>
                            <p className="text-sm">Zatím žádná data k zobrazení</p>
                            <p className="text-xs mt-1">Graf se vyplní po dokončení první zakázky</p>
                        </div>
                    ) : (
                        <div style={{position:'relative', width:'100%', overflowX:'auto'}}>
                            <svg
                                viewBox={`0 0 ${W} ${H}`}
                                style={{width:'100%', minWidth:320, display:'block', overflow:'visible'}}
                                onMouseLeave={() => { setTooltip(null); setHovered(null); }}
                            >
                                <defs>
                                    <linearGradient id="gradRevenue" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stopColor="#9b4d8a" stopOpacity="0.18"/>
                                        <stop offset="100%" stopColor="#9b4d8a" stopOpacity="0.01"/>
                                    </linearGradient>
                                    <linearGradient id="gradCosts" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stopColor="#e07070" stopOpacity="0.13"/>
                                        <stop offset="100%" stopColor="#e07070" stopOpacity="0.01"/>
                                    </linearGradient>
                                    <filter id="dotGlow">
                                        <feGaussianBlur stdDeviation="2.5" result="blur"/>
                                        <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                    </filter>
                                </defs>

                                {/* Grid lines */}
                                {gridLines.map((g, i) => (
                                    <g key={i}>
                                        <line
                                            x1={padL} y1={g.y} x2={W - padR} y2={g.y}
                                            stroke="rgba(180,130,170,0.15)" strokeWidth="1"
                                            strokeDasharray={i === 0 ? '0' : '4 3'}
                                        />
                                        <text
                                            x={padL - 6} y={g.y + 4}
                                            textAnchor="end"
                                            fontSize="9.5"
                                            fill="var(--text-muted)"
                                            fontFamily="DM Sans, sans-serif"
                                        >{g.label}</text>
                                    </g>
                                ))}

                                {/* Area fills */}
                                <path d={makeAreaPath('revenue')} fill="url(#gradRevenue)"/>
                                <path d={makeAreaPath('costs')} fill="url(#gradCosts)"/>

                                {/* Lines */}
                                <path
                                    d={makeSmoothPath('revenue')}
                                    fill="none" stroke="#9b4d8a" strokeWidth="2.2"
                                    strokeLinecap="round" strokeLinejoin="round"
                                    style={{transition: 'all 0.3s'}}
                                />
                                <path
                                    d={makeSmoothPath('costs')}
                                    fill="none" stroke="#e07070" strokeWidth="2.2"
                                    strokeLinecap="round" strokeLinejoin="round"
                                    style={{transition: 'all 0.3s'}}
                                />

                                {/* X-axis labels */}
                                {data.map((d, i) => (
                                    <text
                                        key={i}
                                        x={xPos(i)} y={H - 6}
                                        textAnchor="middle"
                                        fontSize="9.5"
                                        fill={i === n - 1 ? 'var(--accent)' : 'var(--text-muted)'}
                                        fontFamily="DM Sans, sans-serif"
                                        fontWeight={i === n - 1 ? '600' : '400'}
                                    >{d.label}</text>
                                ))}

                                {/* Invisible hover zones per data point */}
                                {data.map((d, i) => {
                                    const x = xPos(i);
                                    const zoneW = innerW / (n - 1);
                                    return (
                                        <rect
                                            key={i}
                                            x={x - zoneW / 2} y={padT}
                                            width={zoneW} height={innerH}
                                            fill="transparent"
                                            style={{cursor: 'crosshair'}}
                                            onMouseEnter={(e) => {
                                                const svgEl = e.currentTarget.closest('svg');
                                                const rect = svgEl.getBoundingClientRect();
                                                const scaleX = W / rect.width;
                                                setTooltip({ idx: i, svgX: x, svgY: Math.min(yPos(d.revenue), yPos(d.costs)) - 12 });
                                                setHovered(i);
                                            }}
                                        />
                                    );
                                })}

                                {/* Hover vertical line */}
                                {hovered !== null && (
                                    <line
                                        x1={xPos(hovered)} y1={padT}
                                        x2={xPos(hovered)} y2={padT + innerH}
                                        stroke="rgba(155,77,138,0.25)" strokeWidth="1.5"
                                        strokeDasharray="4 3"
                                        style={{pointerEvents:'none'}}
                                    />
                                )}

                                {/* Data dots - revenue */}
                                {data.map((d, i) => (
                                    <circle
                                        key={`r${i}`}
                                        cx={xPos(i)} cy={yPos(d.revenue)}
                                        r={hovered === i ? 5.5 : (d.revenue > 0 ? 3 : 0)}
                                        fill={hovered === i ? '#9b4d8a' : 'rgba(155,77,138,0.6)'}
                                        stroke="white" strokeWidth="1.5"
                                        style={{transition:'all 0.15s', pointerEvents:'none', filter: hovered===i ? 'url(#dotGlow)' : 'none'}}
                                    />
                                ))}

                                {/* Data dots - costs */}
                                {data.map((d, i) => (
                                    <circle
                                        key={`c${i}`}
                                        cx={xPos(i)} cy={yPos(d.costs)}
                                        r={hovered === i ? 5.5 : (d.costs > 0 ? 3 : 0)}
                                        fill={hovered === i ? '#e07070' : 'rgba(224,112,112,0.6)'}
                                        stroke="white" strokeWidth="1.5"
                                        style={{transition:'all 0.15s', pointerEvents:'none', filter: hovered===i ? 'url(#dotGlow)' : 'none'}}
                                    />
                                ))}

                                {/* Tooltip */}
                                {tooltip !== null && (() => {
                                    const d = data[tooltip.idx];
                                    const profit = d.revenue - d.costs;
                                    const tw = 148, th = 80;
                                    let tx = tooltip.svgX - tw / 2;
                                    if (tx < padL) tx = padL;
                                    if (tx + tw > W - padR) tx = W - padR - tw;
                                    const ty = Math.max(padT, tooltip.svgY - th - 8);
                                    return (
                                        <g style={{pointerEvents:'none'}}>
                                            <rect
                                                x={tx} y={ty} width={tw} height={th}
                                                rx="8" ry="8"
                                                fill="rgba(42,31,40,0.92)"
                                                style={{backdropFilter:'blur(8px)'}}
                                            />
                                            <text x={tx + tw/2} y={ty + 14} textAnchor="middle" fontSize="10" fill="rgba(255,255,255,0.65)" fontFamily="DM Sans, sans-serif" fontWeight="500">
                                                {d.fullLabel}{d.count > 0 ? ` · ${d.count} zak.` : ''}
                                            </text>
                                            <text x={tx + 10} y={ty + 30} fontSize="9.5" fill="rgba(255,255,255,0.55)" fontFamily="DM Sans, sans-serif">Příjmy</text>
                                            <text x={tx + tw - 10} y={ty + 30} textAnchor="end" fontSize="10" fill="#c47bba" fontFamily="DM Sans, sans-serif" fontWeight="600">
                                                {d.revenue > 0 ? formatCurrency(d.revenue) : '—'}
                                            </text>
                                            <text x={tx + 10} y={ty + 46} fontSize="9.5" fill="rgba(255,255,255,0.55)" fontFamily="DM Sans, sans-serif">Náklady</text>
                                            <text x={tx + tw - 10} y={ty + 46} textAnchor="end" fontSize="10" fill="#e07070" fontFamily="DM Sans, sans-serif" fontWeight="600">
                                                {d.costs > 0 ? formatCurrency(d.costs) : '—'}
                                            </text>
                                            <line x1={tx + 8} y1={ty + 54} x2={tx + tw - 8} y2={ty + 54} stroke="rgba(255,255,255,0.12)" strokeWidth="1"/>
                                            <text x={tx + 10} y={ty + 68} fontSize="9.5" fill="rgba(255,255,255,0.55)" fontFamily="DM Sans, sans-serif">Zisk</text>
                                            <text x={tx + tw - 10} y={ty + 68} textAnchor="end" fontSize="10" fill={profit >= 0 ? '#7abf8e' : '#e07070'} fontFamily="DM Sans, sans-serif" fontWeight="700">
                                                {d.revenue > 0 || d.costs > 0 ? formatCurrency(profit) : '—'}
                                            </text>
                                        </g>
                                    );
                                })()}
                            </svg>
                        </div>
                    )}
                </div>
            );
        };

        // Dashboard Component
        const Dashboard = ({ orders, fabrics, decorations, basics }) => {
            const activeOrders = orders.filter(o => o.status === 'active');
            const completedOrders = orders.filter(o => o.status === 'completed');
            
            // Get current month's orders
            const now = new Date();
            const currentMonthOrders = completedOrders.filter(o => {
                const orderDate = new Date(o.completedAt || o.createdAt);
                return orderDate.getMonth() === now.getMonth() && 
                       orderDate.getFullYear() === now.getFullYear();
            });
            
            // Financial metrics
            const totalRevenue = completedOrders.reduce((sum, order) => {
                return sum + calculateOrderTotal(order);
            }, 0);
            
            const totalCosts = completedOrders.reduce((sum, order) => {
                return sum + calculateOrderCosts(order);
            }, 0);
            
            const totalProfit = totalRevenue - totalCosts;
            
            const monthRevenue = currentMonthOrders.reduce((sum, order) => {
                return sum + calculateOrderTotal(order);
            }, 0);
            
            const monthCosts = currentMonthOrders.reduce((sum, order) => {
                return sum + calculateOrderCosts(order);
            }, 0);
            
            const monthProfit = monthRevenue - monthCosts;
            
            // Average margin
            const avgMargin = totalCosts > 0 ? ((totalProfit / totalCosts) * 100) : 0;
            
            // Total hours worked
            const totalHours = completedOrders.reduce((sum, order) => {
                return sum + (order.preparationTime || 0) + (order.seamstressTime || 0);
            }, 0);
            
            // Effective hourly rate
            const hourlyRate = totalHours > 0 ? (totalProfit / totalHours) : 0;
            
            // Average order value
            const avgOrderValue = completedOrders.length > 0 ? (totalRevenue / completedOrders.length) : 0;
            
            // Top customers (by revenue)
            const customerRevenue = {};
            completedOrders.forEach(order => {
                const customer = order.customer || 'Bez jména';
                const total = calculateOrderTotal(order);
                customerRevenue[customer] = (customerRevenue[customer] || 0) + total;
            });
            const topCustomers = Object.entries(customerRevenue)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);
            
            // Stock alerts (low quantity items)
            const lowStockFabrics = fabrics.filter(f => f.quantity < 3);
            const lowStockDecorations = decorations?.filter(d => d.quantity < 5) || [];
            const lowStockBasics = basics?.filter(b => b.quantity < 10) || [];
            
            // Unused items (not used in any order)
            const usedFabricIds = new Set();
            
            orders.forEach(order => {
                order.fabrics?.forEach(f => usedFabricIds.add(f.fabricId));
            });
            
            const unusedFabrics = fabrics.filter(f => !usedFabricIds.has(f.id));
            
            // Stock value
            const fabricsValue = fabrics.reduce((sum, f) => sum + (f.quantity * f.pricePerM2), 0);
            const decorationsValue = decorations?.reduce((sum, d) => sum + (d.quantity * d.price), 0) || 0;
            const basicsValue = basics?.reduce((sum, b) => sum + (b.quantity * b.price), 0) || 0;
            const totalStockValue = fabricsValue + decorationsValue + basicsValue;

            const stats = [
                { label: 'Aktivní zakázky', value: activeOrders.length, icon: 'orders', bg: 'rgba(100,130,240,0.12)', color: '#6482f0' },
                { label: 'Dokončené', value: completedOrders.length, icon: 'checkCircle', bg: 'rgba(74,155,98,0.12)', color: '#4a9b62' },
                { label: 'Celkový obrat', value: formatCurrency(totalRevenue), icon: 'trending', bg: 'rgba(155,77,138,0.12)', color: 'var(--accent)' },
                { label: 'Celkový zisk', value: formatCurrency(totalProfit), icon: 'money', bg: 'rgba(196,138,80,0.12)', color: 'var(--amber)' }
            ];

            // Monthly chart data — posledních 12 měsíců
            const monthlyChartData = [];
            for (let i = 11; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const label = d.toLocaleDateString('cs-CZ', { month: 'short' });
                const fullLabel = d.toLocaleDateString('cs-CZ', { month: 'long', year: 'numeric' });
                const mo = completedOrders.filter(o => {
                    const od = new Date(o.completedAt || o.createdAt);
                    return od.getMonth() === d.getMonth() && od.getFullYear() === d.getFullYear();
                });
                const revenue = mo.reduce((s, o) => s + calculateOrderTotal(o), 0);
                const costs   = mo.reduce((s, o) => s + calculateOrderCosts(o), 0);
                monthlyChartData.push({ label, fullLabel, revenue, costs, count: mo.length });
            }

            return (
                <div className="fade-in space-y-6">
                    {/* Stats Grid */}
                    <div className="grid grid-4">
                        {stats.map((stat, index) => (
                            <div key={index} className="stat-card">
                                <div className="stat-icon-wrap" style={{background: stat.bg}}>
                                    <Icon name={stat.icon} size={18} color={stat.color} strokeWidth={1.8} />
                                </div>
                                <p className="stat-label">{stat.label}</p>
                                <p className="stat-value">{stat.value}</p>
                            </div>
                        ))}
                    </div>

                    {/* Interactive Line Chart */}
                    <LineChart data={monthlyChartData} />

                    {/* Analytics Cards */}
                    <div className="grid grid-2">
                        {/* This Month */}
                        <div className="card">
                            <h3 className="font-semibold mb-3 flex items-center gap-2">
                                <span className="section-icon"><Icon name="chart" size={14} color="var(--accent)" /></span>
                                <span>Tento měsíc</span>
                            </h3>
                            <div className="space-y-2">
                                <div className="flex justify-between text-sm">
                                    <span className="text-gray">Obrat:</span>
                                    <span className="font-semibold">{formatCurrency(monthRevenue)}</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                    <span className="text-gray">Náklady:</span>
                                    <span className="font-semibold">{formatCurrency(monthCosts)}</span>
                                </div>
                                <div className="flex justify-between text-sm border-t pt-2">
                                    <span className="text-gray">Zisk:</span>
                                    <span className="font-semibold text-green">{formatCurrency(monthProfit)}</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                    <span className="text-gray">Zakázky:</span>
                                    <span className="font-semibold">{currentMonthOrders.length}</span>
                                </div>
                            </div>
                        </div>

                        {/* Efficiency */}
                        <div className="card">
                            <h3 className="font-semibold mb-3 flex items-center gap-2">
                                <span className="section-icon"><Icon name="zap" size={14} color="var(--accent)" /></span>
                                <span>Efektivita</span>
                            </h3>
                            <div className="space-y-2">
                                <div className="flex justify-between text-sm">
                                    <span className="text-gray">Průměrná marže:</span>
                                    <span className="font-semibold text-green">{avgMargin.toFixed(1)}%</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                    <span className="text-gray">Hodinová sazba:</span>
                                    <span className="font-semibold">{formatCurrency(hourlyRate)}/h</span>
                                </div>
                                <div className="flex justify-between text-sm border-t pt-2">
                                    <span className="text-gray">Průměrná zakázka:</span>
                                    <span className="font-semibold">{formatCurrency(avgOrderValue)}</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                    <span className="text-gray">Celkem hodin:</span>
                                    <span className="font-semibold">{totalHours.toFixed(1)}h</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Top Customers & Alerts */}
                    <div style={{display:'grid', gap:'1rem', gridTemplateColumns:'1fr'}}>
                        {/* Top Customers */}
                        <div className="card">
                            <h3 className="font-semibold mb-3 flex items-center gap-2">
                                <span className="section-icon"><Icon name="users" size={14} color="var(--accent)" /></span>
                                <span>Top zákazníci</span>
                            </h3>
                            {topCustomers.length === 0 ? (
                                <p className="text-sm text-gray">Zatím žádné dokončené zakázky</p>
                            ) : (
                                <div className="space-y-3">
                                    {topCustomers.map(([customer, revenue], index) => (
                                        <div key={customer} className="flex justify-between items-center">
                                            <div className="flex items-center gap-2 min-w-0 flex-1">
                                                <span className="font-semibold text-sm flex-shrink-0" style={{color: ['#f59e0b', '#b86aad', '#8b7fd4'][index]}}>
                                                    {index + 1}.
                                                </span>
                                                <span className="text-sm truncate">{customer}</span>
                                            </div>
                                            <span className="font-semibold text-sm flex-shrink-0 ml-2">{formatCurrency(revenue)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* Alerts & Warnings */}
                        <div className="card">
                            <h3 className="font-semibold mb-3 flex items-center gap-2">
                                <span className="section-icon" style={{background:'rgba(196,138,80,0.12)'}}><Icon name="alert" size={14} color="var(--amber)" /></span>
                                <span>Upozornění</span>
                            </h3>
                            <div className="space-y-3">
                                {lowStockFabrics.length > 0 && (
                                    <div>
                                        <p className="text-sm font-medium mb-1" style={{color:'var(--amber)',display:'flex',alignItems:'center',gap:'0.3rem'}}><Icon name="box" size={13} color="var(--amber)"/> Dochází látka:</p>
                                        {lowStockFabrics.slice(0, 2).map(f => (
                                            <p key={f.id} className="text-sm text-gray ml-4 mb-0.5">
                                                • {f.name} ({f.quantity} m²)
                                            </p>
                                        ))}
                                    </div>
                                )}
                                {lowStockDecorations.length > 0 && (
                                    <div>
                                        <p className="text-sm font-medium mb-1" style={{color:'var(--amber)',display:'flex',alignItems:'center',gap:'0.3rem'}}><Icon name="sparkle" size={13} color="var(--amber)"/> Dochází zdobení:</p>
                                        {lowStockDecorations.slice(0, 2).map(d => (
                                            <p key={d.id} className="text-sm text-gray ml-4 mb-0.5">
                                                • {d.name} ({d.quantity} {d.unit})
                                            </p>
                                        ))}
                                    </div>
                                )}
                                {lowStockBasics.length > 0 && (
                                    <div>
                                        <p className="text-sm font-medium mb-1" style={{color:'var(--amber)',display:'flex',alignItems:'center',gap:'0.3rem'}}><Icon name="package" size={13} color="var(--amber)"/> Dochází basic:</p>
                                        {lowStockBasics.slice(0, 2).map(b => (
                                            <p key={b.id} className="text-sm text-gray ml-4 mb-0.5">
                                                • {b.name} ({b.quantity} {b.unit})
                                            </p>
                                        ))}
                                    </div>
                                )}
                                {unusedFabrics.length > 0 && (
                                    <div>
                                        <p className="text-sm font-medium mb-1" style={{color:'#5b8dd9',display:'flex',alignItems:'center',gap:'0.3rem'}}><Icon name="sparkle" size={13} color="#5b8dd9"/> Nepoužité látky:</p>
                                        {unusedFabrics.slice(0, 2).map(f => (
                                            <p key={f.id} className="text-sm text-gray ml-4 mb-0.5">
                                                • {f.name} ({formatCurrency(f.quantity * f.pricePerM2)})
                                            </p>
                                        ))}
                                    </div>
                                )}
                                {lowStockFabrics.length === 0 && lowStockDecorations.length === 0 && 
                                 lowStockBasics.length === 0 && unusedFabrics.length === 0 && (
                                    <p className="text-sm text-gray" style={{display:'flex',alignItems:'center',gap:'0.4rem'}}><Icon name="checkCircle" size={14} color="var(--success)"/> Žádná upozornění</p>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Stock Value */}
                    <div className="card">
                        <h3 className="font-semibold mb-3 flex items-center gap-2">
                            <span className="section-icon"><Icon name="package" size={14} color="var(--accent)"/></span>
                            <span>Hodnota skladu</span>
                        </h3>
                        <div className="grid grid-4">
                            <div className="text-center">
                                <p className="text-xs text-gray mb-1">Látky</p>
                                <p className="font-semibold text-sm">{formatCurrency(fabricsValue)}</p>
                            </div>
                            <div className="text-center">
                                <p className="text-xs text-gray mb-1">Zdobení</p>
                                <p className="font-semibold text-sm">{formatCurrency(decorationsValue)}</p>
                            </div>
                            <div className="text-center">
                                <p className="text-xs text-gray mb-1">Basic</p>
                                <p className="font-semibold text-sm">{formatCurrency(basicsValue)}</p>
                            </div>
                            <div className="text-center" style={{borderLeft: '2px solid #e5e7eb'}}>
                                <p className="text-xs text-gray mb-1">Celkem</p>
                                <p className="font-semibold text-base text-green">{formatCurrency(totalStockValue)}</p>
                            </div>
                        </div>
                    </div>

                    {/* Recent Orders */}
                    <div className="card">
                        <h2 className="text-lg heading-font font-semibold mb-3">
                            Poslední zakázky
                        </h2>
                        {orders.length === 0 ? (
                            <div className="empty-state">
                                <div style={{width:'3.5rem',height:'3.5rem',borderRadius:'1rem',background:'rgba(155,77,138,0.08)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 1rem'}}><Icon name="orders" size={28} color="var(--text-muted)"/></div>
                                <p>Zatím nemáte žádné zakázky</p>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {orders.slice(0, 5).map(order => (
                                    <div key={order.id} className="list-item">
                                        <div className="flex items-center justify-between gap-3">
                                            <div className="flex items-center gap-2 flex-1 min-w-0">
                                                <div className="text-xl">
                                                    {order.status === 'active' ? <Icon name='history' size={18} color='var(--amber)'/> : <Icon name='checkCircle' size={18} color='#4a9b62'/>}
                                                </div>
                                                <div className="min-w-0 flex-1">
                                                    <p className="font-bold text-sm">{order.customer || 'Bez jména'}</p>
                                                    <p className="text-xs text-gray truncate">{order.name}</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-semibold text-sm">
                                                    {formatCurrency(calculateOrderTotal(order))}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Inventory Component
        const Inventory = ({ fabrics, setFabrics, decorations, setDecorations, basics, setBasics, orders, showToast }) => {
            const [inventoryTab, setInventoryTab] = useState('fabrics');
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                type: '',
                quantity: '',
                pricePerM2: '',
                color: '',
                image: '',
                unit: 'ks' // for decorations
            });

            // Helper function to check if item is used in active orders
            const isItemUsedInOrders = (itemId, type) => {
                return orders?.filter(o => o.status === 'active').some(order => {
                    if (type === 'fabric') {
                        return order.fabrics?.some(f => f.fabricId === itemId);
                    } else {
                        return order.decorations?.some(d => d.decorationId === itemId);
                    }
                });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (inventoryTab === 'fabrics') {
                    const fabricData = {
                        ...formData,
                        id: editingId || Date.now().toString(),
                        quantity: parseFloat(formData.quantity),
                        pricePerM2: parseFloat(formData.pricePerM2),
                        createdAt: editingId ? fabrics.find(f => f.id === editingId)?.createdAt : new Date().toISOString()
                    };

                    if (editingId) {
                        setFabrics(fabrics.map(f => f.id === editingId ? fabricData : f));
                        showToast('✅ Látka aktualizována');
                    } else {
                        setFabrics([...fabrics, fabricData]);
                        showToast('✅ Látka přidána');
                    }
                } else if (inventoryTab === 'decorations') {
                    // Decorations
                    const decorationData = {
                        id: editingId || Date.now().toString(),
                        name: formData.name,
                        color: formData.color,
                        price: parseFloat(formData.pricePerM2), // reusing this field for decoration price
                        quantity: parseFloat(formData.quantity),
                        unit: formData.unit || 'ks',
                        image: formData.image,
                        createdAt: editingId ? decorations.find(d => d.id === editingId)?.createdAt : new Date().toISOString()
                    };

                    if (editingId) {
                        setDecorations(decorations.map(d => d.id === editingId ? decorationData : d));
                        showToast('✅ Zdobení aktualizováno');
                    } else {
                        setDecorations([...decorations, decorationData]);
                        showToast('✅ Zdobení přidáno');
                    }
                } else {
                    // Basics
                    const basicData = {
                        id: editingId || Date.now().toString(),
                        name: formData.name,
                        color: formData.color,
                        price: parseFloat(formData.pricePerM2), // reusing this field for basic price
                        quantity: parseFloat(formData.quantity),
                        unit: formData.unit || 'ks',
                        image: formData.image,
                        createdAt: editingId ? basics.find(b => b.id === editingId)?.createdAt : new Date().toISOString()
                    };

                    if (editingId) {
                        setBasics(basics.map(b => b.id === editingId ? basicData : b));
                        showToast('✅ Basic aktualizován');
                    } else {
                        setBasics([...basics, basicData]);
                        showToast('✅ Basic přidán');
                    }
                }

                resetForm();
            };

            const handleEdit = (item, type) => {
                if (type === 'fabric') {
                    setFormData({
                        name: item.name,
                        type: item.type || '',
                        quantity: item.quantity.toString(),
                        pricePerM2: item.pricePerM2.toString(),
                        color: item.color || '',
                        image: item.image || '',
                        unit: item.unit || 'ks'
                    });
                    setInventoryTab('fabrics');
                } else if (type === 'decoration') {
                    setFormData({
                        name: item.name,
                        color: item.color,
                        quantity: item.quantity.toString(),
                        pricePerM2: item.price.toString(),
                        unit: item.unit || 'ks',
                        image: item.image || '',
                        type: ''
                    });
                    setInventoryTab('decorations');
                } else {
                    // basic
                    setFormData({
                        name: item.name,
                        color: item.color,
                        quantity: item.quantity.toString(),
                        pricePerM2: item.price.toString(),
                        unit: item.unit || 'ks',
                        image: item.image || '',
                        type: ''
                    });
                    setInventoryTab('basics');
                }
                setEditingId(item.id);
                setShowForm(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleDelete = (id, type) => {
                if (window.confirm(`Opravdu chcete smazat tuto položku?`)) {
                    if (type === 'fabric') {
                        setFabrics(fabrics.filter(f => f.id !== id));
                        showToast('✅ Látka smazána');
                    } else if (type === 'decoration') {
                        setDecorations(decorations.filter(d => d.id !== id));
                        showToast('✅ Zdobení smazáno');
                    } else {
                        setBasics(basics.filter(b => b.id !== id));
                        showToast('✅ Basic smazán');
                    }
                }
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    type: '',
                    quantity: '',
                    pricePerM2: '',
                    color: '',
                    image: '',
                    unit: 'ks'
                });
                setEditingId(null);
                setShowForm(false);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2000000) {
                        alert('⚠️ Obrázek je příliš velký (max 2MB)');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setFormData({ ...formData, image: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="fade-in space-y-4">
                    <div className="flex items-center justify-between">
                        <h2 className="text-xl heading-font font-semibold">
                            Sklad
                        </h2>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="btn btn-primary btn-small"
                        >
                            {showForm ? <Icon name='close' size={18}/> : <Icon name='plus' size={18}/>}
                        </button>
                    </div>

                    {/* Tabs for Fabrics vs Decorations */}
                    <div className="sub-tabs">
                        <button onClick={() => { setInventoryTab('fabrics'); setShowForm(false); resetForm(); }} className={`sub-tab ${inventoryTab === 'fabrics' ? 'active' : ''}`}>Látky</button>
                        <button onClick={() => { setInventoryTab('decorations'); setShowForm(false); resetForm(); }} className={`sub-tab ${inventoryTab === 'decorations' ? 'active' : ''}`}>Zdobení</button>
                        <button onClick={() => { setInventoryTab('basics'); setShowForm(false); resetForm(); }} className={`sub-tab ${inventoryTab === 'basics' ? 'active' : ''}`}>Basic</button>
                    </div>

                    {/* Add/Edit Form */}
                    {showForm && (
                        <div className="card">
                            <h3 className="font-semibold mb-4">
                                {editingId 
                                    ? `Upravit ${inventoryTab === 'fabrics' ? 'látku' : inventoryTab === 'decorations' ? 'zdobení' : 'basic'}` 
                                    : `Nová ${inventoryTab === 'fabrics' ? 'látka' : inventoryTab === 'decorations' ? 'zdobení' : 'basic'}`}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-3">
                                    <div className="form-group">
                                        <label className="form-label">Název *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="form-input"
                                            placeholder={inventoryTab === 'fabrics' ? 'např. Bavlněná látka' : inventoryTab === 'decorations' ? 'např. Krajka, Knoflíky' : 'např. Nitě, Zip'}
                                        />
                                    </div>

                                    {inventoryTab === 'fabrics' && (
                                        <div className="form-group">
                                            <label className="form-label">Typ *</label>
                                            <input
                                                type="text"
                                                required
                                                value={formData.type}
                                                onChange={(e) => setFormData({...formData, type: e.target.value})}
                                                className="form-input"
                                                placeholder="např. Bavlna, Hedvábí"
                                            />
                                        </div>
                                    )}

                                    <div className="grid grid-2 gap-3">
                                        <div className="form-group">
                                            <label className="form-label">
                                                {inventoryTab === 'fabrics' ? 'Množství (m²) *' : 'Množství *'}
                                            </label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                required
                                                value={formData.quantity}
                                                onChange={(e) => setFormData({...formData, quantity: e.target.value})}
                                                className="form-input"
                                                placeholder="0.00"
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">
                                                {inventoryTab === 'fabrics' ? 'Cena za m² (Kč) *' : 'Cena za kus/m (Kč) *'}
                                            </label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                required
                                                value={formData.pricePerM2}
                                                onChange={(e) => setFormData({...formData, pricePerM2: e.target.value})}
                                                className="form-input"
                                                placeholder="0.00"
                                            />
                                        </div>
                                    </div>

                                    {inventoryTab === 'decorations' && (
                                        <div className="form-group">
                                            <label className="form-label">Jednotka *</label>
                                            <select
                                                value={formData.unit}
                                                onChange={(e) => setFormData({...formData, unit: e.target.value})}
                                                className="form-select"
                                                required
                                            >
                                                <option value="ks">kusy (ks)</option>
                                                <option value="m">metry (m)</option>
                                            </select>
                                        </div>
                                    )}

                                    <div className="form-group">
                                        <label className="form-label">Barva</label>
                                        <input
                                            type="text"
                                            value={formData.color}
                                            onChange={(e) => setFormData({...formData, color: e.target.value})}
                                            className="form-input"
                                            placeholder="např. Bílá, Zlatá"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Obrázek (max 2MB)</label>
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={handleImageUpload}
                                            className="form-input"
                                        />
                                        {formData.image && (
                                            <div className="mt-2">
                                                <img src={formData.image} alt="Preview" style={{width: '100%', maxHeight: '150px', objectFit: 'cover', borderRadius: '0.5rem'}} />
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="flex gap-2 mt-4">
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="btn btn-secondary flex-1"
                                    >
                                        Zrušit
                                    </button>
                                    <button
                                        type="submit"
                                        className="btn btn-primary flex-1"
                                    >
                                        {editingId ? 'Uložit' : 'Přidat'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    )}

                    {/* Items Grid - Fabrics */}
                    {inventoryTab === 'fabrics' && (
                        <>
                            {fabrics.length === 0 ? (
                                <div className="card">
                                    <div className="empty-state">
                                        <div style={{width:'3.5rem',height:'3.5rem',borderRadius:'1rem',background:'rgba(155,77,138,0.08)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 1rem'}}><Icon name="package" size={28} color="var(--text-muted)"/></div>
                                        <p>Zatím nemáte žádné látky na skladě</p>
                                        <p className="text-xs mt-2">Klikněte na + pro přidání</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="grid grid-2">
                                    {fabrics.map(fabric => {
                                        const isUsed = isItemUsedInOrders(fabric.id, 'fabric');
                                        return (
                                        <div key={fabric.id} className="fabric-card" style={{opacity: isUsed ? 0.7 : 1, position: 'relative'}}>
                                            {isUsed && (
                                                <div style={{
                                                    position: 'absolute',
                                                    top: '8px',
                                                    right: '8px',
                                                    background: '#ef4444',
                                                    color: 'white',
                                                    padding: '4px 8px',
                                                    borderRadius: '6px',
                                                    fontSize: '0.7rem',
                                                    fontWeight: '600',
                                                    zIndex: 10,
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                                                }}>
                                                    Použito
                                                </div>
                                            )}
                                            {fabric.image && (
                                                <div className="fabric-image">
                                                    <img src={fabric.image} alt={fabric.name} />
                                                </div>
                                            )}
                                            <div className="fabric-content">
                                                <h3 className="fabric-name">{fabric.name}</h3>
                                                <div className="space-y-1">
                                                    <div className="fabric-info">
                                                        <span>Typ:</span>
                                                        <span className="font-medium">{fabric.type}</span>
                                                    </div>
                                                    <div className="fabric-info">
                                                        <span>Množství:</span>
                                                        <span className="font-medium">{fabric.quantity} m²</span>
                                                    </div>
                                                    <div className="fabric-info">
                                                        <span>Cena/m²:</span>
                                                        <span className="font-medium">{formatCurrency(fabric.pricePerM2)}</span>
                                                    </div>
                                                    {fabric.color && (
                                                        <div className="fabric-info">
                                                            <span>Barva:</span>
                                                            <span className="font-medium">{fabric.color}</span>
                                                        </div>
                                                    )}
                                                    <div className="fabric-info border-t pt-1 font-semibold">
                                                        <span>Hodnota:</span>
                                                        <span>{formatCurrency(fabric.quantity * fabric.pricePerM2)}</span>
                                                    </div>
                                                </div>
                                                <div className="fabric-actions">
                                                    <button
                                                        onClick={() => handleEdit(fabric, 'fabric')}
                                                        className="btn btn-secondary flex-1 btn-small"
                                                    ><Icon name="edit" size={15}/>
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(fabric.id, 'fabric')}
                                                        className="btn btn-danger flex-1 btn-small"
                                                        disabled={isUsed}
                                                        style={{opacity: isUsed ? 0.5 : 1}}
                                                    ><Icon name="trash" size={15}/></button>
                                                </div>
                                            </div>
                                        </div>
                                    )})}
                                </div>
                            )}
                        </>
                    )}

                    {/* Items Grid - Decorations */}
                    {inventoryTab === 'decorations' && (
                        <>
                            {(!decorations || decorations.length === 0) ? (
                                <div className="card">
                                    <div className="empty-state">
                                        <div style={{width:'3.5rem',height:'3.5rem',borderRadius:'1rem',background:'rgba(155,77,138,0.08)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 1rem'}}><Icon name="sparkle" size={28} color="var(--text-muted)"/></div>
                                        <p>Zatím nemáte žádné zdobení na skladě</p>
                                        <p className="text-xs mt-2">Klikněte na + pro přidání</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="grid grid-2">
                                    {decorations.map(decoration => {
                                        const isUsed = isItemUsedInOrders(decoration.id, 'decoration');
                                        return (
                                        <div key={decoration.id} className="fabric-card" style={{opacity: isUsed ? 0.7 : 1, position: 'relative'}}>
                                            {isUsed && (
                                                <div style={{
                                                    position: 'absolute',
                                                    top: '8px',
                                                    right: '8px',
                                                    background: '#ef4444',
                                                    color: 'white',
                                                    padding: '4px 8px',
                                                    borderRadius: '6px',
                                                    fontSize: '0.7rem',
                                                    fontWeight: '600',
                                                    zIndex: 10,
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                                                }}>
                                                    Použito
                                                </div>
                                            )}
                                            {decoration.image && (
                                                <div className="fabric-image">
                                                    <img src={decoration.image} alt={decoration.name} />
                                                </div>
                                            )}
                                            <div className="fabric-content">
                                                <h3 className="fabric-name">{decoration.name}</h3>
                                                <div className="space-y-1">
                                                    <div className="fabric-info">
                                                        <span>Množství:</span>
                                                        <span className="font-medium">{decoration.quantity} {decoration.unit}</span>
                                                    </div>
                                                    <div className="fabric-info">
                                                        <span>Cena/{decoration.unit}:</span>
                                                        <span className="font-medium">{formatCurrency(decoration.price)}</span>
                                                    </div>
                                                    {decoration.color && (
                                                        <div className="fabric-info">
                                                            <span>Barva:</span>
                                                            <span className="font-medium">{decoration.color}</span>
                                                        </div>
                                                    )}
                                                    <div className="fabric-info border-t pt-1 font-semibold">
                                                        <span>Hodnota:</span>
                                                        <span>{formatCurrency(decoration.quantity * decoration.price)}</span>
                                                    </div>
                                                </div>
                                                <div className="fabric-actions">
                                                    <button
                                                        onClick={() => handleEdit(decoration, 'decoration')}
                                                        className="btn btn-secondary flex-1 btn-small"><Icon name="edit" size={15}/></button>
                                                    <button
                                                        onClick={() => handleDelete(decoration.id, 'decoration')}
                                                        className="btn btn-danger flex-1 btn-small"
                                                        disabled={isUsed}
                                                        style={{opacity: isUsed ? 0.5 : 1}}
                                                    ><Icon name="trash" size={15}/></button>
                                                </div>
                                            </div>
                                        </div>
                                    )})}
                                </div>
                            )}
                        </>
                    )}

                    {/* Items Grid - Basics */}
                    {inventoryTab === 'basics' && (
                        <>
                            {(!basics || basics.length === 0) ? (
                                <div className="card">
                                    <div className="empty-state">
                                        <div style={{width:'3.5rem',height:'3.5rem',borderRadius:'1rem',background:'rgba(155,77,138,0.08)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 1rem'}}><Icon name="package" size={28} color="var(--text-muted)"/></div>
                                        <p>Zatím nemáte žádné Basic na skladě</p>
                                        <p className="text-xs mt-2">Klikněte na + pro přidání</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="grid grid-2">
                                    {basics.map(basic => {
                                        const isUsed = isItemUsedInOrders(basic.id, 'basic');
                                        return (
                                        <div key={basic.id} className="fabric-card" style={{opacity: isUsed ? 0.7 : 1, position: 'relative'}}>
                                            {isUsed && (
                                                <div style={{
                                                    position: 'absolute',
                                                    top: '8px',
                                                    right: '8px',
                                                    background: '#ef4444',
                                                    color: 'white',
                                                    padding: '4px 8px',
                                                    borderRadius: '6px',
                                                    fontSize: '0.7rem',
                                                    fontWeight: '600',
                                                    zIndex: 10,
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                                                }}>
                                                    Použito
                                                </div>
                                            )}
                                            {basic.image && (
                                                <div className="fabric-image">
                                                    <img src={basic.image} alt={basic.name} />
                                                </div>
                                            )}
                                            <div className="fabric-content">
                                                <h3 className="fabric-name">{basic.name}</h3>
                                                <div className="space-y-1">
                                                    <div className="fabric-info">
                                                        <span>Množství:</span>
                                                        <span className="font-medium">{basic.quantity} {basic.unit}</span>
                                                    </div>
                                                    <div className="fabric-info">
                                                        <span>Cena/{basic.unit}:</span>
                                                        <span className="font-medium">{formatCurrency(basic.price)}</span>
                                                    </div>
                                                    {basic.color && (
                                                        <div className="fabric-info">
                                                            <span>Barva:</span>
                                                            <span className="font-medium">{basic.color}</span>
                                                        </div>
                                                    )}
                                                    <div className="fabric-info border-t pt-1 font-semibold">
                                                        <span>Hodnota:</span>
                                                        <span>{formatCurrency(basic.quantity * basic.price)}</span>
                                                    </div>
                                                </div>
                                                <div className="fabric-actions">
                                                    <button
                                                        onClick={() => handleEdit(basic, 'basic')}
                                                        className="btn btn-secondary flex-1 btn-small"><Icon name="edit" size={15}/></button>
                                                    <button
                                                        onClick={() => handleDelete(basic.id, 'basic')}
                                                        className="btn btn-danger flex-1 btn-small"
                                                        disabled={isUsed}
                                                        style={{opacity: isUsed ? 0.5 : 1}}
                                                    ><Icon name="trash" size={15}/></button>
                                                </div>
                                            </div>
                                        </div>
                                    )})}
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        };

        // Orders Component
        const Orders = ({ orders, setOrders, fabrics, decorations, basics, rates, showToast }) => {
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [saveStatus, setSaveStatus] = useState('saved'); // 'saved', 'saving', 'error'
            const [formData, setFormData] = useState({
                name: '',
                customer: '',
                preparationTime: '',
                seamstressTime: '',
                seamstressPrice: '',
                salePrice: '',
                selectedFabrics: [],
                selectedDecorations: [],
                selectedBasics: [],
                extras: [],
                images: [],
                notes: '',
                color: '#9b4d8a'
            });

            // Auto-save with debouncing (1 second delay)
            React.useEffect(() => {
                // Only auto-save if form is open and has required fields
                if (!showForm || !formData.customer || !formData.name) {
                    return;
                }

                setSaveStatus('saving');
                
                // Debounce: wait 1 second after last change
                const timeoutId = setTimeout(() => {
                    try {
                        handleAutoSave();
                        setSaveStatus('saved');
                    } catch (error) {
                        setSaveStatus('error');
                        console.error('Auto-save error:', error);
                    }
                }, 1000);

                return () => clearTimeout(timeoutId);
            }, [formData, showForm, orders, editingId]);

            const handleAutoSave = () => {
                if (!formData.customer || !formData.name) {
                    return;
                }

                const orderData = {
                    ...formData,
                    id: editingId || Date.now().toString(),
                    preparationTime: parseFloat(formData.preparationTime) || 0,
                    seamstressTime: parseFloat(formData.seamstressTime) || 0,
                    seamstressPrice: parseFloat(formData.seamstressPrice) || 0,
                    salePrice: parseFloat(formData.salePrice) || 0,
                    preparationRate: rates.preparation,
                    seamstressRate: rates.seamstress,
                    status: editingId ? orders.find(o => o.id === editingId)?.status || 'active' : 'active',
                    createdAt: editingId ? orders.find(o => o.id === editingId)?.createdAt : new Date().toISOString(),
                    completedAt: editingId ? orders.find(o => o.id === editingId)?.completedAt : null
                };

                orderData.fabrics = orderData.selectedFabrics.map(sf => {
                    const fabric = fabrics.find(f => f.id === sf.fabricId);
                    return {
                        ...sf,
                        fabricId: sf.fabricId,
                        name: fabric?.name,
                        pricePerM2: fabric?.pricePerM2,
                        totalCost: sf.quantity * (fabric?.pricePerM2 || 0)
                    };
                });

                orderData.decorations = orderData.selectedDecorations.map(sd => {
                    const decoration = decorations?.find(d => d.id === sd.decorationId);
                    return {
                        ...sd,
                        decorationId: sd.decorationId,
                        name: decoration?.name,
                        price: decoration?.price,
                        unit: decoration?.unit,
                        totalCost: sd.quantity * (decoration?.price || 0)
                    };
                });

                orderData.basics = (orderData.selectedBasics || []).map(sb => {
                    const basic = basics?.find(b => b.id === sb.basicId);
                    return {
                        ...sb,
                        basicId: sb.basicId,
                        name: basic?.name,
                        price: basic?.price,
                        unit: basic?.unit,
                        totalCost: sb.quantity * (basic?.price || 0)
                    };
                });

                if (editingId) {
                    setOrders(orders.map(o => o.id === editingId ? orderData : o));
                } else {
                    // For new orders, check if already exists
                    const existingOrder = orders.find(o => o.id === orderData.id);
                    if (existingOrder) {
                        setOrders(orders.map(o => o.id === orderData.id ? orderData : o));
                    } else {
                        setOrders([...orders, orderData]);
                        setEditingId(orderData.id); // Set editing ID so next save updates
                    }
                }
            };

            // Color palette for orders
            const orderColors = [
                { name: 'Růžová',      value: '#9b4d8a', light: '#f5e6f2' },
                { name: 'Lila',        value: '#c47bba', light: '#f7eaf5' },
                { name: 'Levandule',   value: '#8b7fd4', light: '#eeecf9' },
                { name: 'Modrá',       value: '#5b8dd9', light: '#deeaf8' },
                { name: 'Tyrkys',      value: '#3aabbf', light: '#d6f2f6' },
                { name: 'Šalvěj',      value: '#5a9b7a', light: '#daf0e6' },
                { name: 'Karamel',     value: '#c48a50', light: '#f7eddf' },
                { name: 'Starorůžová', value: '#c4748a', light: '#f7e5ea' },
            ];


            const handleEdit = (order) => {
                setFormData({
                    name: order.name,
                    customer: order.customer || '',
                    preparationTime: order.preparationTime.toString(),
                    seamstressTime: order.seamstressTime.toString(),
                    seamstressPrice: order.seamstressPrice ? order.seamstressPrice.toString() : '',
                    salePrice: order.salePrice ? order.salePrice.toString() : '',
                    selectedFabrics: order.fabrics?.map(f => ({
                        fabricId: f.fabricId || fabrics.find(fab => fab.name === f.name)?.id || '',
                        quantity: f.quantity
                    })) || [],
                    selectedDecorations: order.decorations?.map(d => ({
                        decorationId: d.decorationId || decorations?.find(dec => dec.name === d.name)?.id || '',
                        quantity: d.quantity
                    })) || [],
                    selectedBasics: order.basics?.map(b => ({
                        basicId: b.basicId || basics?.find(basic => basic.name === b.name)?.id || '',
                        quantity: b.quantity
                    })) || [],
                    extras: order.extras || [],
                    images: order.images || [],
                    notes: order.notes || '',
                    color: order.color || '#9b4d8a'
                });
                setEditingId(order.id);
                setShowForm(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    customer: '',
                    preparationTime: '',
                    seamstressTime: '',
                    seamstressPrice: '',
                    salePrice: '',
                    selectedFabrics: [],
                    selectedDecorations: [],
                    selectedBasics: [],
                    extras: [],
                    images: [],
                    notes: '',
                    color: '#9b4d8a'
                });
                setEditingId(null);
                setShowForm(false);
            };

            const addDecoration = () => {
                setFormData({
                    ...formData,
                    selectedDecorations: [...formData.selectedDecorations, { decorationId: '', quantity: '' }]
                });
            };

            const removeDecoration = (index) => {
                setFormData({
                    ...formData,
                    selectedDecorations: formData.selectedDecorations.filter((_, i) => i !== index)
                });
            };

            const updateDecoration = (index, field, value) => {
                const updated = [...formData.selectedDecorations];
                updated[index] = { ...updated[index], [field]: value };
                setFormData({ ...formData, selectedDecorations: updated });
            };

            const addBasic = () => {
                setFormData({
                    ...formData,
                    selectedBasics: [...formData.selectedBasics, { basicId: '', quantity: '' }]
                });
            };

            const removeBasic = (index) => {
                setFormData({
                    ...formData,
                    selectedBasics: formData.selectedBasics.filter((_, i) => i !== index)
                });
            };

            const updateBasic = (index, field, value) => {
                const updated = [...formData.selectedBasics];
                updated[index] = { ...updated[index], [field]: value };
                setFormData({ ...formData, selectedBasics: updated });
            };

            const addFabric = () => {
                setFormData({
                    ...formData,
                    selectedFabrics: [...formData.selectedFabrics, { fabricId: '', quantity: '' }]
                });
            };

            const removeFabric = (index) => {
                setFormData({
                    ...formData,
                    selectedFabrics: formData.selectedFabrics.filter((_, i) => i !== index)
                });
            };

            const updateFabric = (index, field, value) => {
                const updated = [...formData.selectedFabrics];
                updated[index] = { ...updated[index], [field]: value };
                setFormData({ ...formData, selectedFabrics: updated });
            };

            const addExtra = () => {
                setFormData({
                    ...formData,
                    extras: [...formData.extras, { name: '', price: '' }]
                });
            };

            const removeExtra = (index) => {
                setFormData({
                    ...formData,
                    extras: formData.extras.filter((_, i) => i !== index)
                });
            };

            const updateExtra = (index, field, value) => {
                const updated = [...formData.extras];
                updated[index] = { ...updated[index], [field]: value };
                setFormData({ ...formData, extras: updated });
            };

            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                if (files.length + formData.images.length > 6) {
                    alert('⚠️ Maximálně 6 obrázků');
                    return;
                }
                
                const readers = files.map(file => {
                    if (file.size > 2000000) {
                        alert('⚠️ Některé obrázky jsou příliš velké (max 2MB)');
                        return Promise.resolve(null);
                    }
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(file);
                    });
                });

                Promise.all(readers).then(images => {
                    const validImages = images.filter(img => img !== null);
                    setFormData({
                        ...formData,
                        images: [...formData.images, ...validImages]
                    });
                });
            };

            const removeImage = (index) => {
                setFormData({
                    ...formData,
                    images: formData.images.filter((_, i) => i !== index)
                });
            };

            const calculateTotal = () => {
                const fabricsCost = formData.selectedFabrics.reduce((sum, sf) => {
                    const fabric = fabrics.find(f => f.id === sf.fabricId);
                    return sum + (parseFloat(sf.quantity) || 0) * (fabric?.pricePerM2 || 0);
                }, 0);

                const decorationsCost = formData.selectedDecorations.reduce((sum, sd) => {
                    const decoration = decorations?.find(d => d.id === sd.decorationId);
                    return sum + (parseFloat(sd.quantity) || 0) * (decoration?.price || 0);
                }, 0);

                const basicsCost = (formData.selectedBasics || []).reduce((sum, sb) => {
                    const basic = basics?.find(b => b.id === sb.basicId);
                    return sum + (parseFloat(sb.quantity) || 0) * (basic?.price || 0);
                }, 0);

                const prepCost = (parseFloat(formData.preparationTime) || 0) * rates.preparation;
                const seamCost = parseFloat(formData.seamstressPrice) || 0;
                const extrasCost = formData.extras.reduce((sum, e) => sum + (parseFloat(e.price) || 0), 0);
                const totalCosts = fabricsCost + decorationsCost + basicsCost + prepCost + seamCost + extrasCost;
                
                const salePrice = parseFloat(formData.salePrice) || 0;
                const marginAmount = salePrice - totalCosts;
                const marginPercent = totalCosts > 0 ? (marginAmount / totalCosts) * 100 : 0;

                return { 
                    fabricsCost, 
                    decorationsCost, 
                    basicsCost,
                    prepCost, 
                    seamCost, 
                    extrasCost, 
                    totalCosts, 
                    salePrice,
                    marginAmount,
                    marginPercent
                };
            };

            const costs = calculateTotal();

            return (
                <div className="fade-in space-y-4">
                    <div className="flex items-center justify-between">
                        <h2 className="text-xl heading-font font-semibold">
                            Zakázky
                        </h2>
                        <button
                            onClick={() => {
                                setShowForm(!showForm);
                                if (!showForm) window.scrollTo({ top: 0, behavior: 'smooth' });
                            }}
                            className="btn btn-primary btn-small"
                        >
                            {showForm ? <Icon name='close' size={18}/> : <Icon name='plus' size={18}/>}
                        </button>
                    </div>

                    {/* Order Form */}
                    {showForm && (
                        <div className="card">
                            <h3 className="font-semibold mb-4">
                                {editingId ? 'Upravit zakázku' : 'Nová zakázka'}
                            </h3>
                            <div>
                                <div className="space-y-3">
                                    <div className="form-group">
                                        <label className="form-label">Jméno zákazníka *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.customer}
                                            onChange={(e) => setFormData({...formData, customer: e.target.value})}
                                            className="form-input"
                                            placeholder="např. Jana Nováková"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Název zakázky *</label>
                                        <input
                                            type="text"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="form-input"
                                            placeholder="např. Svatební šaty"
                                        />
                                    </div>

                                    {/* Fabrics Section */}
                                    <div className="border-t pt-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="font-semibold text-sm" style={{display:"flex",alignItems:"center",gap:"0.375rem"}}><Icon name="package" size={14} color="var(--accent)"/> Látky</h4>
                                            <button
                                                type="button"
                                                onClick={addFabric}
                                                className="btn btn-secondary btn-small"
                                            ><Icon name="plus" size={15}/></button>
                                        </div>
                                        {formData.selectedFabrics.map((sf, index) => (
                                            <div key={index} className="space-y-2 mb-3 list-item">
                                                <select
                                                    value={sf.fabricId}
                                                    onChange={(e) => updateFabric(index, 'fabricId', e.target.value)}
                                                    className="form-select"
                                                    required
                                                >
                                                    <option value="">Vyberte látku</option>
                                                    {fabrics.map(fabric => (
                                                        <option key={fabric.id} value={fabric.id}>
                                                            {fabric.name} ({fabric.quantity} m²)
                                                        </option>
                                                    ))}
                                                </select>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={sf.quantity}
                                                        onChange={(e) => updateFabric(index, 'quantity', e.target.value)}
                                                        className="form-input flex-1"
                                                        placeholder="m²"
                                                        required
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removeFabric(index)}
                                                        className="btn btn-danger btn-small"
                                                    ><Icon name="trash" size={15}/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Decorations Section */}
                                    <div className="border-t pt-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="font-semibold text-sm">Zdobení</h4>
                                            <button
                                                type="button"
                                                onClick={addDecoration}
                                                className="btn btn-secondary btn-small"
                                            ><Icon name="plus" size={15}/></button>
                                        </div>
                                        {formData.selectedDecorations.map((sd, index) => (
                                            <div key={index} className="space-y-2 mb-3 list-item">
                                                <select
                                                    value={sd.decorationId}
                                                    onChange={(e) => updateDecoration(index, 'decorationId', e.target.value)}
                                                    className="form-select"
                                                    required
                                                >
                                                    <option value="">Vyberte zdobení</option>
                                                    {decorations?.map(decoration => (
                                                        <option key={decoration.id} value={decoration.id}>
                                                            {decoration.name} ({decoration.quantity} {decoration.unit})
                                                        </option>
                                                    ))}
                                                </select>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={sd.quantity}
                                                        onChange={(e) => updateDecoration(index, 'quantity', e.target.value)}
                                                        className="form-input flex-1"
                                                        placeholder="Množství"
                                                        required
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removeDecoration(index)}
                                                        className="btn btn-danger btn-small"
                                                    ><Icon name="trash" size={15}/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Basics Section */}
                                    <div className="border-t pt-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="font-semibold text-sm">Basic</h4>
                                            <button
                                                type="button"
                                                onClick={addBasic}
                                                className="btn btn-secondary btn-small"
                                            ><Icon name="plus" size={15}/></button>
                                        </div>
                                        {formData.selectedBasics?.map((sb, index) => (
                                            <div key={index} className="space-y-2 mb-3 list-item">
                                                <select
                                                    value={sb.basicId}
                                                    onChange={(e) => updateBasic(index, 'basicId', e.target.value)}
                                                    className="form-select"
                                                    required
                                                >
                                                    <option value="">Vyberte basic</option>
                                                    {basics?.map(basic => (
                                                        <option key={basic.id} value={basic.id}>
                                                            {basic.name} ({basic.quantity} {basic.unit})
                                                        </option>
                                                    ))}
                                                </select>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={sb.quantity}
                                                        onChange={(e) => updateBasic(index, 'quantity', e.target.value)}
                                                        className="form-input flex-1"
                                                        placeholder="Množství"
                                                        required
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removeBasic(index)}
                                                        className="btn btn-danger btn-small"
                                                    ><Icon name="trash" size={15}/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Time Tracking */}
                                    <div className="border-t pt-3">
                                        <h4 className="font-semibold text-sm mb-2" style={{display:"flex",alignItems:"center",gap:"0.375rem"}}><Icon name="history" size={14} color="var(--accent)"/> Čas</h4>
                                        <div className="space-y-2">
                                            <div className="form-group">
                                                <label className="form-label">Příprava (hodiny)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={formData.preparationTime}
                                                    onChange={(e) => setFormData({...formData, preparationTime: e.target.value})}
                                                    className="form-input"
                                                    placeholder="0.0"
                                                />
                                                <p className="text-xs text-gray mt-1">
                                                    {formatCurrency(rates.preparation)}/hod
                                                </p>
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">Švadlena (celková cena v Kč)</label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={formData.seamstressPrice || ''}
                                                    onChange={(e) => setFormData({...formData, seamstressPrice: e.target.value})}
                                                    className="form-input"
                                                    placeholder="0"
                                                />
                                                {formData.seamstressPrice && parseFloat(formData.seamstressPrice) > 0 && (
                                                    <p className="text-xs text-gray mt-1">
                                                        ≈ {(parseFloat(formData.seamstressPrice) / rates.seamstress).toFixed(1)} hodin 
                                                        (sazba: {formatCurrency(rates.seamstress)}/hod)
                                                    </p>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Extras */}
                                    <div className="border-t pt-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="font-semibold text-sm">🔧 Vícepráce</h4>
                                            <button
                                                type="button"
                                                onClick={addExtra}
                                                className="btn btn-secondary btn-small"
                                            ><Icon name="plus" size={15}/></button>
                                        </div>
                                        {formData.extras.map((extra, index) => (
                                            <div key={index} className="space-y-2 mb-3 list-item">
                                                <input
                                                    type="text"
                                                    value={extra.name}
                                                    onChange={(e) => updateExtra(index, 'name', e.target.value)}
                                                    className="form-input"
                                                    placeholder="Název práce"
                                                    required
                                                />
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={extra.price}
                                                        onChange={(e) => updateExtra(index, 'price', e.target.value)}
                                                        className="form-input flex-1"
                                                        placeholder="Kč"
                                                        required
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => removeExtra(index)}
                                                        className="btn btn-danger btn-small"
                                                    ><Icon name="trash" size={15}/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Sale Price */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">Prodejní cena (Kč) *</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                required
                                                value={formData.salePrice}
                                                onChange={(e) => setFormData({...formData, salePrice: e.target.value})}
                                                className="form-input"
                                                placeholder="0.00"
                                            />
                                            <p className="text-xs text-gray mt-1">
                                                Finální cena, za kterou prodáváte zakázku zákazníkovi
                                            </p>
                                        </div>
                                    </div>

                                    {/* Color Picker */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">🎨 Barva zakázky</label>
                                            <div style={{display: 'flex', gap: '0.5rem', flexWrap: 'wrap'}}>
                                                {orderColors.map(color => (
                                                    <button
                                                        key={color.value}
                                                        type="button"
                                                        onClick={() => setFormData({...formData, color: color.value})}
                                                        style={{
                                                            width: '3rem',
                                                            height: '3rem',
                                                            borderRadius: '0.75rem',
                                                            border: formData.color === color.value ? '3px solid #000' : '2px solid #d6d3d1',
                                                            background: color.value,
                                                            cursor: 'pointer',
                                                            transform: formData.color === color.value ? 'scale(1.1)' : 'scale(1)',
                                                            transition: 'all 0.2s',
                                                            boxShadow: formData.color === color.value ? '0 4px 8px rgba(0,0,0,0.2)' : '0 2px 4px rgba(0,0,0,0.1)'
                                                        }}
                                                        title={color.name}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Images */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">📷 Fotografie (max 6, 2MB)</label>
                                            <input
                                                type="file"
                                                multiple
                                                accept="image/*"
                                                onChange={handleImageUpload}
                                                className="form-input"
                                            />
                                        </div>
                                        {formData.images.length > 0 && (
                                            <div className="image-grid">
                                                {formData.images.map((img, index) => (
                                                    <div key={index} className="image-preview">
                                                        <img src={img} alt={`Náhled ${index + 1}`} />
                                                        <button
                                                            type="button"
                                                            onClick={() => removeImage(index)}
                                                            className="image-remove"
                                                        ><Icon name="close" size={13}/></button>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Notes */}
                                    <div className="border-t pt-3">
                                        <div className="form-group">
                                            <label className="form-label">Poznámky</label>
                                            <textarea
                                                value={formData.notes}
                                                onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                                className="form-textarea"
                                                placeholder="Další poznámky..."
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Cost Summary */}
                                <div className="summary-section">
                                    <h4 className="font-semibold mb-2">💵 Kalkulace</h4>
                                    <div className="summary-row">
                                        <span>Látky:</span>
                                        <span>{formatCurrency(costs.fabricsCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>Zdobení:</span>
                                        <span>{formatCurrency(costs.decorationsCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>Basic:</span>
                                        <span>{formatCurrency(costs.basicsCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>Příprava:</span>
                                        <span>{formatCurrency(costs.prepCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>Švadlena:</span>
                                        <span>{formatCurrency(costs.seamCost)}</span>
                                    </div>
                                    <div className="summary-row">
                                        <span>Vícepráce:</span>
                                        <span>{formatCurrency(costs.extrasCost)}</span>
                                    </div>
                                    <div className="summary-row border-t pt-2 font-semibold">
                                        <span>Celkové náklady:</span>
                                        <span>{formatCurrency(costs.totalCosts)}</span>
                                    </div>
                                    <div className="summary-total" style={{background: '#f0fdf4', borderRadius: '0.5rem', padding: '0.75rem', marginTop: '0.75rem', border: '2px solid #10b981'}}>
                                        <span>Prodejní cena:</span>
                                        <span style={{color: '#10b981'}}>{formatCurrency(costs.salePrice)}</span>
                                    </div>
                                    <div className="summary-row" style={{fontSize: '0.875rem', marginTop: '0.5rem'}}>
                                        <span>Marže:</span>
                                        <span className={costs.marginAmount >= 0 ? 'text-green' : 'text-red'} style={{fontWeight: '600'}}>
                                            {formatCurrency(costs.marginAmount)} ({costs.marginPercent.toFixed(1)}%)
                                        </span>
                                    </div>
                                </div>

                                <div className="flex gap-2 mt-3 items-center justify-between">
                                    <button
                                        type="button"
                                        onClick={resetForm}
                                        className="btn btn-secondary"
                                    >
                                        ✓ Zavřít
                                    </button>
                                    <div className="text-xs flex items-center gap-1">
                                        {saveStatus === 'saved' && (
                                            <span className="text-green-600">✓ Uloženo</span>
                                        )}
                                        {saveStatus === 'saving' && (
                                            <span className="text-gray" style={{display:"flex",alignItems:"center",gap:"0.3rem"}}><Icon name="rotate" size={13} color="var(--text-muted)"/> Ukládám...</span>
                                        )}
                                        {saveStatus === 'error' && (
                                            <span className="text-red" style={{display:"flex",alignItems:"center",gap:"0.3rem"}}><Icon name="alert" size={13} color="var(--danger)"/> Chyba ukládání</span>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Search */}
                    {!showForm && (
                        <input
                            type="text"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            placeholder="🔍 Hledat podle jména zákazníka nebo názvu zakázky..."
                            className="form-input"
                        />
                    )}

                    {/* Active Orders List */}
                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            <span style={{display:"flex",alignItems:"center",gap:"0.5rem"}}><Icon name="orders" size={16} color="var(--accent)"/> Aktivní zakázky</span>
                        </h3>
                        {(() => {
                            const filteredOrders = orders
                                .filter(o => o.status === 'active')
                                .filter(o => {
                                    const matchesSearch = searchTerm === '' || 
                                        o.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                        o.customer?.toLowerCase().includes(searchTerm.toLowerCase());
                                    return matchesSearch;
                                });

                            return filteredOrders.length === 0 ? (
                                <div className="empty-state">
                                    <p className="text-sm">
                                        {searchTerm ? 'Žádné zakázky nevyhovují hledání' : 'Žádné aktivní zakázky'}
                                    </p>
                                </div>
                            ) : (
                                <div className="space-y-2">
                                    {filteredOrders.map(order => (
                                        <OrderCard 
                                            key={order.id} 
                                            order={order} 
                                            orders={orders}
                                            setOrders={setOrders}
                                            showToast={showToast}
                                            onEdit={handleEdit}
                                        />
                                    ))}
                                </div>
                            );
                        })()}
                    </div>
                </div>
            );
        };

        // Order Card Component
        const OrderCard = ({ order, orders, setOrders, showToast, onEdit }) => {
            const [expanded, setExpanded] = useState(false);

            const markComplete = () => {
                if (window.confirm('Označit jako dokončenou?')) {
                    setOrders(orders.map(o => 
                        o.id === order.id ? { ...o, status: 'completed', completedAt: new Date().toISOString() } : o
                    ));
                    showToast('✅ Zakázka dokončena');
                }
            };

            const deleteOrder = () => {
                if (window.confirm('Opravdu smazat?')) {
                    setOrders(orders.filter(o => o.id !== order.id));
                    showToast('✅ Zakázka smazána');
                }
            };

            const handleEdit = () => {
                onEdit(order);
            };

            const total = calculateOrderTotal(order);

            return (
                <div 
                    className="order-card" 
                    style={{
                        borderLeft: `5px solid ${order.color || '#9b4d8a'}`,
                        background: `linear-gradient(to right, ${order.color || '#9b4d8a'}08 0%, transparent 100%)`
                    }}
                >
                    <div className="order-header" onClick={() => setExpanded(!expanded)}>
                        <div className="flex-1 min-w-0">
                            <h4 className="font-bold text-base truncate">{order.customer || 'Bez jména'}</h4>
                            <p className="text-sm text-gray mt-1">
                                {order.name}
                            </p>
                            <p className="text-xs text-gray mt-0.5">
                                {formatDate(order.createdAt)}
                            </p>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="text-right">
                                <p className="font-bold text-sm">{formatCurrency(total)}</p>
                            </div>
                            <div className="text-lg">
                                {expanded ? '🔼' : '🔽'}
                            </div>
                        </div>
                    </div>

                    {expanded && (
                        <div className="order-details space-y-3">
                            {/* Color indicator header */}
                            <div 
                                style={{
                                    background: `linear-gradient(135deg, ${order.color || '#9b4d8a'} 0%, ${order.color || '#b86aad'} 100%)`,
                                    margin: '-1rem -1rem 1rem -1rem',
                                    padding: '0.5rem 1rem',
                                    borderRadius: '0.75rem 0.75rem 0 0',
                                    color: 'white',
                                    fontWeight: '600',
                                    fontSize: '0.75rem'
                                }}
                            >
                                Zakázka
                            </div>

                            {/* Fabrics */}
                            {order.fabrics && order.fabrics.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1" style={{display:"flex",alignItems:"center",gap:"0.3rem"}}><Icon name="package" size={13} color="var(--accent)"/> Látky</h5>
                                    {order.fabrics.map((f, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{f.name} ({f.quantity} m²)</span>
                                            <span>{formatCurrency(f.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Decorations */}
                            {order.decorations && order.decorations.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">Zdobení</h5>
                                    {order.decorations.map((d, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{d.name} ({d.quantity} {d.unit})</span>
                                            <span>{formatCurrency(d.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Basics */}
                            {order.basics && order.basics.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">Basic</h5>
                                    {order.basics.map((b, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{b.name} ({b.quantity} {b.unit})</span>
                                            <span>{formatCurrency(b.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Time */}
                            <div>
                                <h5 className="font-medium text-sm mb-1" style={{display:"flex",alignItems:"center",gap:"0.3rem"}}><Icon name="history" size={13} color="var(--accent)"/> Čas</h5>
                                <div className="flex justify-between text-xs text-gray mb-1">
                                    <span>Příprava ({order.preparationTime}h)</span>
                                    <span>{formatCurrency(order.preparationTime * order.preparationRate)}</span>
                                </div>
                                <div className="flex justify-between text-xs text-gray">
                                    <span>Švadlena {order.seamstressPrice > 0 && order.seamstressRate > 0 && `(≈${(order.seamstressPrice / order.seamstressRate).toFixed(1)}h)`}</span>
                                    <span>{formatCurrency(order.seamstressPrice > 0 ? order.seamstressPrice : (order.seamstressTime * order.seamstressRate))}</span>
                                </div>
                            </div>

                            {/* Extras */}
                            {order.extras && order.extras.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">🔧 Vícepráce</h5>
                                    {order.extras.map((e, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{e.name}</span>
                                            <span>{formatCurrency(e.price)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Images */}
                            {order.images && order.images.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">📷 Fotografie</h5>
                                    <div className="image-grid">
                                        {order.images.map((img, i) => (
                                            <img 
                                                key={i}
                                                src={img}
                                                alt={`Foto ${i + 1}`}
                                                style={{width: '100%', height: '5rem', objectFit: 'cover', borderRadius: '0.5rem', cursor: 'pointer'}}
                                                onClick={() => window.open(img, '_blank')}
                                            />
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Notes */}
                            {order.notes && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">Poznámky</h5>
                                    <p className="text-xs text-gray">{order.notes}</p>
                                </div>
                            )}

                            {/* Actions */}
                            <div className="flex gap-2 border-t pt-3">
                                <button
                                    onClick={handleEdit}
                                    className="btn btn-secondary flex-1 btn-small"
                                ><Icon name="edit" size={15}/> Upravit</button>
                                <button
                                    onClick={markComplete}
                                    className="btn btn-success flex-1 btn-small"
                                ><Icon name="checkCircle" size={15}/> Dokončit</button>
                                <button
                                    onClick={deleteOrder}
                                    className="btn btn-danger btn-small"
                                ><Icon name="trash" size={15}/></button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // History Component
        const History = ({ orders, setOrders, showToast }) => {
            const [filter, setFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');

            const filteredOrders = orders.filter(order => {
                const matchesFilter = filter === 'all' || order.status === filter;
                const matchesSearch = order.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     order.customer?.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            const exportOrder = (order) => {
                const total = calculateOrderTotal(order);
                const costs = calculateOrderCosts(order);

                let text = `ZAKÁZKA: ${order.name}\n`;
                text += `========================================\n`;
                text += `Zákazník: ${order.customer || 'N/A'}\n`;
                text += `Vytvořeno: ${formatDate(order.createdAt)}\n`;
                if (order.completedAt) {
                    text += `Dokončeno: ${formatDate(order.completedAt)}\n`;
                }
                text += `\nLÁTKY:\n`;
                order.fabrics?.forEach(f => {
                    text += `- ${f.name}: ${f.quantity} m² × ${formatCurrency(f.pricePerM2)} = ${formatCurrency(f.totalCost)}\n`;
                });
                text += `\nČAS:\n`;
                text += `- Příprava: ${order.preparationTime}h × ${formatCurrency(order.preparationRate)} = ${formatCurrency(order.preparationTime * order.preparationRate)}\n`;
                if (order.seamstressPrice && order.seamstressPrice > 0) {
                    const hours = order.seamstressRate > 0 
                        ? (order.seamstressPrice / order.seamstressRate).toFixed(1) + 'h'
                        : 'N/A';
                    text += `- Švadlena: ${formatCurrency(order.seamstressPrice)} (≈${hours})\n`;
                } else {
                    text += `- Švadlena: ${order.seamstressTime}h × ${formatCurrency(order.seamstressRate)} = ${formatCurrency(order.seamstressTime * order.seamstressRate)}\n`;
                }
                if (order.extras?.length > 0) {
                    text += `\nVÍCEPRÁCE:\n`;
                    order.extras.forEach(e => {
                        text += `- ${e.name}: ${formatCurrency(e.price)}\n`;
                    });
                }
                text += `\n========================================\n`;
                text += `Náklady: ${formatCurrency(costs)}\n`;
                text += `CELKEM: ${formatCurrency(total)}\n`;
                text += `ZISK: ${formatCurrency(total - costs)}\n`;

                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `zakazka-${order.name.replace(/\s+/g, '-')}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('✅ Zakázka exportována');
            };

            return (
                <div className="fade-in space-y-4">
                    <h2 className="text-xl heading-font font-semibold">Historie</h2>

                    <div className="space-y-2">
                        <input
                            type="text"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            placeholder="🔍 Hledat..."
                            className="form-input"
                        />
                        <select
                            value={filter}
                            onChange={(e) => setFilter(e.target.value)}
                            className="form-select"
                        >
                            <option value="all">Všechny zakázky</option>
                            <option value="active">Aktivní</option>
                            <option value="completed">Dokončené</option>
                        </select>
                    </div>

                    {filteredOrders.length === 0 ? (
                        <div className="card">
                            <div className="empty-state">
                                <div style={{width:"3.5rem",height:"3.5rem",borderRadius:"1rem",background:"rgba(155,77,138,0.08)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem"}}><Icon name="sparkle" size={28} color="var(--text-muted)"/></div>
                                <p>Nenalezeny žádné zakázky</p>
                            </div>
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {filteredOrders.map(order => (
                                <HistoryOrderCard 
                                    key={order.id}
                                    order={order}
                                    exportOrder={exportOrder}
                                    setOrders={setOrders}
                                    showToast={showToast}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // History Order Card Component with expandable details
        const HistoryOrderCard = ({ order, exportOrder, setOrders, showToast }) => {
            const [expanded, setExpanded] = useState(false);
            const total = calculateOrderTotal(order);
            const costs = calculateOrderCosts(order);
            const profit = total - costs;

            const reactivateOrder = () => {
                if (window.confirm('Obnovit zakázku jako aktivní?')) {
                    setOrders(prevOrders => prevOrders.map(o => 
                        o.id === order.id ? { ...o, status: 'active', completedAt: null } : o
                    ));
                    showToast('✅ Zakázka obnovena');
                }
            };

            return (
                <div 
                    className="card" 
                    style={{
                        borderLeft: `5px solid ${order.color || '#9b4d8a'}`,
                        background: `linear-gradient(to right, ${order.color || '#9b4d8a'}08 0%, transparent 100%)`
                    }}
                >
                    <div 
                        className="flex items-start justify-between gap-3 cursor-pointer"
                        onClick={() => setExpanded(!expanded)}
                    >
                        <div className="flex items-center gap-2 flex-1 min-w-0">
                            <div className="text-xl">
                                {order.status === 'active' ? <Icon name='history' size={18} color='var(--amber)'/> : <Icon name='checkCircle' size={18} color='#4a9b62'/>}
                            </div>
                            <div className="min-w-0 flex-1">
                                <h3 className="font-bold text-base">{order.customer || 'Bez jména'}</h3>
                                <p className="text-sm text-gray">{order.name}</p>
                                <p className="text-xs text-gray">
                                    {formatDate(order.createdAt)}
                                    {order.completedAt && ` • Dokončeno: ${formatDate(order.completedAt)}`}
                                </p>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="text-lg">
                                {expanded ? '🔼' : '🔽'}
                            </div>
                        </div>
                    </div>

                    {!expanded && (
                        <div className="grid grid-2 gap-2 list-item mt-3">
                            <div className="text-center">
                                <p className="text-xs text-gray">Celkem</p>
                                <p className="font-semibold text-sm">
                                    {formatCurrency(total)}
                                </p>
                            </div>
                            <div className="text-center">
                                <p className="text-xs text-gray">Zisk</p>
                                <p className="font-semibold text-sm text-green">
                                    {formatCurrency(profit)}
                                </p>
                            </div>
                        </div>
                    )}

                    {expanded && (
                        <div className="order-details space-y-3 mt-3 pt-3 border-t">
                            {/* Color indicator header */}
                            <div 
                                style={{
                                    background: `linear-gradient(135deg, ${order.color || '#9b4d8a'} 0%, ${order.color || '#b86aad'} 100%)`,
                                    margin: '-1rem -1rem 1rem -1rem',
                                    padding: '0.5rem 1rem',
                                    borderRadius: '0.75rem 0.75rem 0 0',
                                    color: 'white',
                                    fontWeight: '600',
                                    fontSize: '0.75rem'
                                }}
                            >
                                {order.status === 'active' ? <span style={{display:'inline-flex',alignItems:'center',gap:'0.3rem'}}><Icon name='history' size={14} color='var(--amber)'/>Aktivní zakázka</span> : <span style={{display:'inline-flex',alignItems:'center',gap:'0.3rem'}}><Icon name='checkCircle' size={14} color='#4a9b62'/>Dokončená zakázka</span>}
                            </div>

                            {/* Summary Stats */}
                            <div className="grid grid-3 gap-2 mb-3">
                                <div className="text-center list-item">
                                    <p className="text-xs text-gray">Celkem</p>
                                    <p className="font-semibold text-sm">{formatCurrency(total)}</p>
                                </div>
                                <div className="text-center list-item">
                                    <p className="text-xs text-gray">Náklady</p>
                                    <p className="font-semibold text-sm">{formatCurrency(costs)}</p>
                                </div>
                                <div className="text-center list-item">
                                    <p className="text-xs text-gray">Zisk</p>
                                    <p className="font-semibold text-sm text-green">{formatCurrency(profit)}</p>
                                </div>
                            </div>

                            {/* Fabrics */}
                            {order.fabrics && order.fabrics.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1" style={{display:"flex",alignItems:"center",gap:"0.3rem"}}><Icon name="package" size={13} color="var(--accent)"/> Látky</h5>
                                    {order.fabrics.map((f, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{f.name} ({f.quantity} m²)</span>
                                            <span>{formatCurrency(f.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Decorations */}
                            {order.decorations && order.decorations.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">Zdobení</h5>
                                    {order.decorations.map((d, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{d.name} ({d.quantity} {d.unit})</span>
                                            <span>{formatCurrency(d.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Basics */}
                            {order.basics && order.basics.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">Basic</h5>
                                    {order.basics.map((b, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{b.name} ({b.quantity} {b.unit})</span>
                                            <span>{formatCurrency(b.totalCost)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Time */}
                            <div>
                                <h5 className="font-medium text-sm mb-1" style={{display:"flex",alignItems:"center",gap:"0.3rem"}}><Icon name="history" size={13} color="var(--accent)"/> Čas</h5>
                                <div className="flex justify-between text-xs text-gray mb-1">
                                    <span>Příprava ({order.preparationTime}h)</span>
                                    <span>{formatCurrency(order.preparationTime * order.preparationRate)}</span>
                                </div>
                                <div className="flex justify-between text-xs text-gray">
                                    <span>Švadlena {order.seamstressPrice > 0 && order.seamstressRate > 0 && `(≈${(order.seamstressPrice / order.seamstressRate).toFixed(1)}h)`}</span>
                                    <span>{formatCurrency(order.seamstressPrice > 0 ? order.seamstressPrice : (order.seamstressTime * order.seamstressRate))}</span>
                                </div>
                            </div>

                            {/* Extras */}
                            {order.extras && order.extras.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">🔧 Vícepráce</h5>
                                    {order.extras.map((e, i) => (
                                        <div key={i} className="flex justify-between text-xs text-gray mb-1">
                                            <span>{e.name}</span>
                                            <span>{formatCurrency(e.price)}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Images */}
                            {order.images && order.images.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">📷 Fotografie</h5>
                                    <div className="image-grid">
                                        {order.images.map((img, i) => (
                                            <img 
                                                key={i}
                                                src={img}
                                                alt={`Foto ${i + 1}`}
                                                style={{width: '100%', height: '5rem', objectFit: 'cover', borderRadius: '0.5rem', cursor: 'pointer'}}
                                                onClick={() => window.open(img, '_blank')}
                                            />
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Notes */}
                            {order.notes && (
                                <div>
                                    <h5 className="font-medium text-sm mb-1">Poznámky</h5>
                                    <p className="text-xs text-gray">{order.notes}</p>
                                </div>
                            )}

                            {/* Actions */}
                            <div className="flex gap-2 border-t pt-3">
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        exportOrder(order);
                                    }}
                                    className="btn btn-secondary flex-1 btn-small"
                                ><Icon name="download" size={15}/> Export</button>
                                {order.status === 'completed' && (
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            reactivateOrder();
                                        }}
                                        className="btn btn-success flex-1 btn-small"
                                    ><Icon name="rotate" size={15}/> Obnovit</button>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Settings Component
        const Settings = ({ 
            rates, setRates, 
            fabrics, decorations, orders, 
            logo, setLogo, 
            sheetsUrl, setSheetsUrl,
            syncEnabled, setSyncEnabled,
            lastSync,
            syncStatus,
            syncToGoogleSheets,
            loadFromGoogleSheets,
            testGoogleSheetsConnection,
            showToast 
        }) => {
            const [tempRates, setTempRates] = useState(rates);

            const handleSave = () => {
                setRates(tempRates);
                showToast('✅ Nastavení uloženo');
            };

            const handleReset = () => {
                if (window.confirm('⚠️ Opravdu vymazat všechna data? Tato akce je nevratná!')) {
                    localStorage.clear();
                    window.location.reload();
                }
            };

            const exportData = () => {
                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    fabrics,
                    decorations,
                    basics: basics || [],
                    orders,
                    rates
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `atelier-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('✅ Data exportována');
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.version && data.fabrics && data.orders && data.rates) {
                            if (window.confirm('Opravdu chcete importovat data? Současná data budou přepsána.')) {
                                window.localStorage.setItem('fabrics', JSON.stringify(data.fabrics));
                                window.localStorage.setItem('decorations', JSON.stringify(data.decorations || []));
                                window.localStorage.setItem('basics', JSON.stringify(data.basics || []));
                                window.localStorage.setItem('orders', JSON.stringify(data.orders));
                                window.localStorage.setItem('rates', JSON.stringify(data.rates));
                                showToast('✅ Data importována');
                                setTimeout(() => window.location.reload(), 1500);
                            }
                        } else {
                            alert('❌ Neplatný formát souboru!');
                        }
                    } catch (error) {
                        alert('❌ Chyba při načítání souboru!');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            return (
                <div className="fade-in space-y-4">
                    <h2 className="text-xl heading-font font-semibold">Nastavení</h2>

                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            🎨 Logo aplikace
                        </h3>
                        <div className="text-center mb-4">
                            <div style={{fontSize: '4rem', height: '5rem', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
                                {logo.startsWith('data:') ? (
                                    <img src={logo} alt="Logo" style={{maxHeight: '5rem', maxWidth: '100%', objectFit: 'contain'}} />
                                ) : (
                                    <span>{logo}</span>
                                )}
                            </div>
                        </div>
                        <div className="space-y-2">
                            <label className="btn btn-secondary w-full" style={{cursor: 'pointer'}}>
                                📤 Nahrát vlastní logo
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={(e) => {
                                        const file = e.target.files[0];
                                        if (file) {
                                            if (file.size > 500000) {
                                                alert('⚠️ Obrázek je příliš velký (max 500KB)');
                                                return;
                                            }
                                            const reader = new FileReader();
                                            reader.onloadend = () => {
                                                setLogo(reader.result);
                                                showToast('✅ Logo aktualizováno');
                                            };
                                            reader.readAsDataURL(file);
                                        }
                                        e.target.value = '';
                                    }}
                                    style={{display: 'none'}}
                                />
                            </label>
                            <button
                                onClick={() => {
                                    setLogo('✂️');
                                    showToast('✅ Logo obnoveno');
                                }}
                                className="btn btn-secondary w-full"
                            ><Icon name="rotate" size={15}/> Obnovit výchozí</button>
                        </div>
                    </div>

                    <div className="card">
                        <h3 className="font-semibold mb-3">Hodinové sazby</h3>
                        <div className="space-y-3 mb-4">
                            <div className="form-group">
                                <label className="form-label">Příprava (Kč/hod)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={tempRates.preparation}
                                    onChange={(e) => setTempRates({...tempRates, preparation: parseFloat(e.target.value)})}
                                    className="form-input"
                                />
                            </div>

                            <div className="form-group">
                                <label className="form-label">Švadlena (Kč/hod)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={tempRates.seamstress}
                                    onChange={(e) => setTempRates({...tempRates, seamstress: parseFloat(e.target.value)})}
                                    className="form-input"
                                />
                            </div>
                        </div>

                        <button
                            onClick={handleSave}
                            className="btn btn-primary w-full"
                        ><Icon name="checkCircle" size={15}/> Uložit</button>
                    </div>

                    {/* Google Sheets Integration */}
                    <div className="card">
                        <h3 className="font-semibold mb-3 flex items-center gap-2">
                            <span className="section-icon"><Icon name="cloud" size={14} color="var(--accent)"/></span>
                            <span>Google Sheets Synchronizace</span>
                        </h3>
                        <p className="text-sm text-gray mb-4">
                            Propojte aplikaci s Google Sheets pro automatické zálohy do cloudu. Data se budou ukládat v reálném čase.
                        </p>
                        <div className="space-y-3">
                            <div className="form-group">
                                <label className="form-label">Apps Script URL</label>
                                <input
                                    type="url"
                                    value={sheetsUrl}
                                    onChange={(e) => setSheetsUrl(e.target.value)}
                                    className="form-input"
                                    placeholder="https://script.google.com/macros/s/..."
                                />
                                <p className="text-xs text-gray mt-1">
                                    📖 Návod na získání URL najdete v dokumentaci
                                </p>
                            </div>
                            
                            <div className="flex items-center gap-2 p-3" style={{background: '#f5f1eb', borderRadius: '0.5rem'}}>
                                <input
                                    type="checkbox"
                                    id="syncEnabled"
                                    checked={syncEnabled}
                                    onChange={(e) => {
                                        if (e.target.checked && !sheetsUrl) {
                                            showToast('⚠️ Nejdřív zadejte URL');
                                            return;
                                        }
                                        setSyncEnabled(e.target.checked);
                                        if (e.target.checked) {
                                            showToast('✅ Automatická synchronizace zapnuta');
                                        }
                                    }}
                                    className="w-4 h-4"
                                />
                                <label htmlFor="syncEnabled" className="text-sm flex-1">Automatická synchronizace</label>
                            </div>
                            
                            {lastSync && (
                                <div className="text-xs text-gray p-2" style={{background: '#f9fafb', borderRadius: '0.375rem'}}>
                                    <strong>Poslední synchronizace:</strong> {new Date(lastSync).toLocaleString('cs-CZ')}
                                </div>
                            )}
                            
                            <div className="grid grid-3 gap-2">
                                <button
                                    onClick={testGoogleSheetsConnection}
                                    className="btn btn-secondary"
                                    disabled={!sheetsUrl || syncStatus === 'syncing'}
                                    title="Otestovat připojení"
                                >
                                    {syncStatus === 'syncing' ? <Icon name='rotate' size={15}/> : <Icon name='wifi' size={15}/>} Test
                                </button>
                                
                                <button
                                    onClick={syncToGoogleSheets}
                                    className="btn btn-primary"
                                    disabled={!sheetsUrl || syncStatus === 'syncing'}
                                >
                                    {syncStatus === 'syncing' ? <><Icon name='rotate' size={15}/> Sync...</> : <><Icon name='cloud' size={15}/> Sync</>}
                                </button>
                                
                                <button
                                    onClick={loadFromGoogleSheets}
                                    className="btn btn-secondary"
                                    disabled={!sheetsUrl || syncStatus === 'syncing'}
                                ><Icon name="upload" size={15}/> Načíst</button>
                            </div>
                            
                            {syncStatus === 'success' && (
                                <div className="text-sm flex items-center gap-2 p-2" style={{color: '#10b981', background: '#d1fae5', borderRadius: '0.375rem'}}>
                                    <span>✓</span>
                                    <span>Úspěšně synchronizováno</span>
                                </div>
                            )}
                            
                            {syncStatus === 'error' && (
                                <div className="text-sm flex items-center gap-2 p-2" style={{color: '#ef4444', background: '#fee2e2', borderRadius: '0.375rem'}}>
                                    <span className="section-icon" style={{background:"rgba(224,112,112,0.1)"}}><Icon name="alert" size={14} color="var(--danger)"/></span>
                                    <span>Chyba synchronizace - zkontrolujte URL a připojení</span>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            Zálohování dat
                        </h3>
                        <p className="text-xs text-gray mb-3">
                            Aplikace automaticky zálohuje data každých 5 minut do prohlížeče. Doporučujeme pravidelně stahovat zálohu do souboru.
                        </p>
                        <div className="space-y-2">
                            <button
                                onClick={exportData}
                                className="btn btn-primary w-full"
                            >
                                Stáhnout zálohu (JSON)
                            </button>
                            <div>
                                <label className="btn btn-secondary w-full" style={{cursor: 'pointer'}}>
                                    📤 Nahrát zálohu (JSON)
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        style={{display: 'none'}}
                                    />
                                </label>
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <h3 className="font-semibold mb-3">
                            Přehled dat
                        </h3>
                        <div className="grid grid-3 gap-2 mb-4">
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{fabrics.length}</div>
                                <div className="text-xs text-gray">Látek</div>
                            </div>
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{decorations?.length || 0}</div>
                                <div className="text-xs text-gray">Zdobení</div>
                            </div>
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{orders.filter(o => o.status === 'active').length}</div>
                                <div className="text-xs text-gray">Aktivních</div>
                            </div>
                        </div>
                        <div className="grid grid-2 gap-2 mb-4">
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{orders.filter(o => o.status === 'completed').length}</div>
                                <div className="text-xs text-gray">Dokončených</div>
                            </div>
                            <div className="text-center list-item">
                                <div className="text-2xl font-bold">{orders.length}</div>
                                <div className="text-xs text-gray">Celkem zakázek</div>
                            </div>
                        </div>
                        <p className="text-xs text-gray mb-3">
                            Data jsou uložena lokálně ve vašem prohlížeči. Pravidelně zálohujte pomocí karty výše.
                        </p>
                        <button
                            onClick={handleReset}
                            className="btn btn-danger w-full"
                        >
                            Vymazat vše
                        </button>
                    </div>

                    <div className="card text-center">
                        <h3 className="font-semibold mb-2">
                            O aplikaci
                        </h3>
                        <p className="text-sm text-gray">
                            <strong>Atelier Manager</strong>
                        </p>
                        <p className="text-xs text-gray mt-1">
                            Verze 1.0 Mobile • React PWA
                        </p>
                        <p className="text-xs text-gray mt-2">
                            Pro iPhone optimalizováno
                        </p>
                    </div>
                </div>
            );
        };

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AtelierManager />);
    </script>
</body>
</html>
